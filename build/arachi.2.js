!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.arachi=e():t.arachi=e()}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){var s;!function(){function n(t,e,i){return t.call.apply(t.bind,arguments)}function a(t,e,i){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,s),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function r(t,e,i){return(r=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?n:a).apply(null,arguments)}var o=Date.now||function(){return+new Date};function h(t,e){this.F=t,this.k=e||t,this.H=this.k.document}var l=!!window.FontFace;function c(t,e,i){(t=t.H.getElementsByTagName(e)[0])||(t=document.documentElement),t.insertBefore(i,t.lastChild)}function u(t,e,i){e=e||[],i=i||[];for(var s=t.className.split(/\s+/),n=0;n<e.length;n+=1){for(var a=!1,r=0;r<s.length;r+=1)if(e[n]===s[r]){a=!0;break}a||s.push(e[n])}for(e=[],n=0;n<s.length;n+=1){for(a=!1,r=0;r<i.length;r+=1)if(s[n]===i[r]){a=!0;break}a||e.push(s[n])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function f(t,e){for(var i=t.className.split(/\s+/),s=0,n=i.length;s<n;s++)if(i[s]==e)return!0;return!1}function d(t){if("string"==typeof t.fa)return t.fa;var e=t.k.location.protocol;return"about:"==e&&(e=t.F.location.protocol),"https:"==e?"https:":"http:"}function p(t,e,i){function s(){o&&n&&a&&(o(r),o=null)}e=t.createElement("link",{rel:"stylesheet",href:e,media:"all"});var n=!1,a=!0,r=null,o=i||null;l?(e.onload=function(){n=!0,s()},e.onerror=function(){n=!0,r=Error("Stylesheet failed to load"),s()}):setTimeout((function(){n=!0,s()}),0),c(t,"head",e)}function g(t,e,i,s){var n=t.H.getElementsByTagName("head")[0];if(n){var a=t.createElement("script",{src:e}),r=!1;return a.onload=a.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,i&&i(null),a.onload=a.onreadystatechange=null,"HEAD"==a.parentNode.tagName&&n.removeChild(a))},n.appendChild(a),setTimeout((function(){r||(r=!0,i&&i(Error("Script load timeout")))}),s||5e3),a}return null}function v(){this.S=0,this.K=null}function _(t){return t.S++,function(){t.S--,k(t)}}function y(t,e){t.K=e,k(t)}function k(t){0==t.S&&t.K&&(t.K(),t.K=null)}function m(t){this.ea=t||"-"}function R(t,e){this.Q=t,this.M=4,this.L="n";var i=(e||"n4").match(/^([nio])([1-9])$/i);i&&(this.L=i[1],this.M=parseInt(i[2],10))}function b(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var s=t[i].replace(/['"]/g,"");-1!=s.indexOf(" ")||/^\d/.test(s)?e.push("'"+s+"'"):e.push(s)}return e.join(",")}function E(t){return t.L+t.M}function w(t){var e="normal";return"o"===t.L?e="oblique":"i"===t.L&&(e="italic"),e}function O(t){var e=4,i="n",s=null;return t&&((s=t.match(/(normal|oblique|italic)/i))&&s[1]&&(i=s[1].substr(0,1).toLowerCase()),(s=t.match(/([1-9]00|normal|bold)/i))&&s[1]&&(/bold/i.test(s[1])?e=7:/[1-9]00/.test(s[1])&&(e=parseInt(s[1].substr(0,1),10)))),i+e}function x(t,e){this.a=t,this.j=t.k.document.documentElement,this.O=e,this.f="wf",this.e=new m("-"),this.da=!1!==e.events,this.u=!1!==e.classes}function T(t){if(t.u){var e=f(t.j,t.e.d(t.f,"active")),i=[],s=[t.e.d(t.f,"loading")];e||i.push(t.e.d(t.f,"inactive")),u(t.j,i,s)}C(t,"inactive")}function C(t,e,i){t.da&&t.O[e]&&(i?t.O[e](i.getName(),E(i)):t.O[e]())}function D(){this.t={}}function N(t,e){this.a=t,this.h=e,this.m=this.a.createElement("span",{"aria-hidden":"true"},this.h)}function A(t,e){var i,s=t.m;i="display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+b(e.Q)+";font-style:"+w(e)+";font-weight:"+e.M+"00;",s.style.cssText=i}function P(t){c(t.a,"body",t.m)}function I(t,e,i,s,n,a){this.G=t,this.J=e,this.g=s,this.a=i,this.v=n||3e3,this.h=a||void 0}function S(t,e,i,s,n,a,r){this.G=t,this.J=e,this.a=i,this.g=s,this.h=r||"BESbswy",this.s={},this.v=n||3e3,this.Z=a||null,this.D=this.C=this.A=this.w=null,this.w=new N(this.a,this.h),this.A=new N(this.a,this.h),this.C=new N(this.a,this.h),this.D=new N(this.a,this.h),A(this.w,new R(this.g.getName()+",serif",E(this.g))),A(this.A,new R(this.g.getName()+",sans-serif",E(this.g))),A(this.C,new R("serif",E(this.g))),A(this.D,new R("sans-serif",E(this.g))),P(this.w),P(this.A),P(this.C),P(this.D)}h.prototype.createElement=function(t,e,i){if(t=this.H.createElement(t),e)for(var s in e)e.hasOwnProperty(s)&&("style"==s?t.style.cssText=e[s]:t.setAttribute(s,e[s]));return i&&t.appendChild(this.H.createTextNode(i)),t},m.prototype.d=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.ea)},R.prototype.getName=function(){return this.Q},N.prototype.remove=function(){var t=this.m;t.parentNode&&t.parentNode.removeChild(t)},I.prototype.start=function(){var t=this.a.k.document,e=this,i=o();!function s(){o()-i>=e.v?e.J(e.g):t.fonts.load(function(t){return w(t)+" "+t.M+"00 300px "+b(t.Q)}(e.g),e.h).then((function(t){1<=t.length?e.G(e.g):setTimeout(s,25)}),(function(){e.J(e.g)}))}()};var L={ia:"serif",ha:"sans-serif"},B=null;function M(){if(null===B){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);B=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return B}function F(t,e,i){for(var s in L)if(L.hasOwnProperty(s)&&e===t.s[L[s]]&&i===t.s[L[s]])return!0;return!1}function K(t){var e,i=t.w.m.offsetWidth,s=t.A.m.offsetWidth;(e=i===t.s.serif&&s===t.s["sans-serif"])||(e=M()&&F(t,i,s)),e?o()-t.ga>=t.v?M()&&F(t,i,s)&&(null===t.Z||t.Z.hasOwnProperty(t.g.getName()))?U(t,t.G):U(t,t.J):function(t){setTimeout(r((function(){K(this)}),t),50)}(t):U(t,t.G)}function U(t,e){setTimeout(r((function(){this.w.remove(),this.A.remove(),this.C.remove(),this.D.remove(),e(this.g)}),t),0)}function V(t,e,i){this.a=t,this.p=e,this.P=0,this.ba=this.Y=!1,this.v=i}S.prototype.start=function(){this.s.serif=this.C.m.offsetWidth,this.s["sans-serif"]=this.D.m.offsetWidth,this.ga=o(),K(this)};var W=null;function H(t){0==--t.P&&t.Y&&(t.ba?((t=t.p).u&&u(t.j,[t.e.d(t.f,"active")],[t.e.d(t.f,"loading"),t.e.d(t.f,"inactive")]),C(t,"active")):T(t.p))}function j(t){this.F=t,this.q=new D,this.$=0,this.T=this.U=!0}function Y(t,e,i,s,n){var a=0==--t.$;(t.T||t.U)&&setTimeout((function(){var t=n||null,o=s||{};if(0===i.length&&a)T(e.p);else{e.P+=i.length,a&&(e.Y=a);var h,l=[];for(h=0;h<i.length;h++){var c=i[h],f=o[c.getName()],d=e.p,p=c;d.u&&u(d.j,[d.e.d(d.f,p.getName(),E(p).toString(),"loading")]),C(d,"fontloading",p),d=null,null===W&&(W=!!window.FontFace&&(!(d=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))||42<parseInt(d[1],10))),d=W?new I(r(e.V,e),r(e.W,e),e.a,c,e.v,f):new S(r(e.V,e),r(e.W,e),e.a,c,e.v,t,f),l.push(d)}for(h=0;h<l.length;h++)l[h].start()}}),0)}function G(t,e,i){this.N=t||e+z,this.o=[],this.R=[],this.ca=i||""}V.prototype.V=function(t){var e=this.p;e.u&&u(e.j,[e.e.d(e.f,t.getName(),E(t).toString(),"active")],[e.e.d(e.f,t.getName(),E(t).toString(),"loading"),e.e.d(e.f,t.getName(),E(t).toString(),"inactive")]),C(e,"fontactive",t),this.ba=!0,H(this)},V.prototype.W=function(t){var e=this.p;if(e.u){var i=f(e.j,e.e.d(e.f,t.getName(),E(t).toString(),"active")),s=[],n=[e.e.d(e.f,t.getName(),E(t).toString(),"loading")];i||s.push(e.e.d(e.f,t.getName(),E(t).toString(),"inactive")),u(e.j,s,n)}C(e,"fontinactive",t),H(this)},j.prototype.load=function(t){this.a=new h(this.F,t.context||this.F),this.U=!1!==t.events,this.T=!1!==t.classes,function(t,e,i){var s=[],n=i.timeout;!function(t){t.u&&u(t.j,[t.e.d(t.f,"loading")]),C(t,"loading")}(e);s=function(t,e,i){var s,n=[];for(s in e)if(e.hasOwnProperty(s)){var a=t.t[s];a&&n.push(a(e[s],i))}return n}(t.q,i,t.a);var a=new V(t.a,e,n);for(t.$=s.length,e=0,i=s.length;e<i;e++)s[e].load((function(e,i,s){Y(t,a,e,i,s)}))}(this,new x(this.a,t),t)};var z="//fonts.googleapis.com/css";function q(t){this.o=t,this.aa=[],this.I={}}G.prototype.d=function(){if(0==this.o.length)throw Error("No fonts to load!");if(-1!=this.N.indexOf("kit="))return this.N;for(var t=this.o.length,e=[],i=0;i<t;i++)e.push(this.o[i].replace(/ /g,"+"));return t=this.N+"?family="+e.join("%7C"),0<this.R.length&&(t+="&subset="+this.R.join(",")),0<this.ca.length&&(t+="&text="+encodeURIComponent(this.ca)),t};var J={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},X={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Z={i:"i",italic:"i",n:"n",normal:"n"},$=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Q(t,e){this.a=t,this.c=e}q.prototype.parse=function(){for(var t=this.o.length,e=0;e<t;e++){var i=this.o[e].split(":"),s=i[0].replace(/\+/g," "),n=["n4"];if(2<=i.length){var a;if(a=[],r=i[1])for(var r,o=(r=r.split(",")).length,h=0;h<o;h++){var l;if((l=r[h]).match(/^[\w-]+$/))if(null==(l=$.exec(l.toLowerCase())))l="";else{var c;if(null==(c=l[1])||""==c)c="4";else{var u=X[c];c=u||(isNaN(c)?"4":c.substr(0,1))}l=[null==(l=l[2])||""==l?"n":Z[l],c].join("")}else l="";l&&a.push(l)}0<a.length&&(n=a),3==i.length&&(a=[],0<(i=(i=i[2])?i.split(","):a).length&&(i=J[i[0]])&&(this.I[s]=i))}for(this.I[s]||(i=J[s])&&(this.I[s]=i),i=0;i<n.length;i+=1)this.aa.push(new R(s,n[i]))}};var tt={Arimo:!0,Cousine:!0,Tinos:!0};function et(t,e){this.a=t,this.c=e,this.X=[]}function it(t,e){this.a=t,this.c=e}function st(t,e){this.a=t,this.c=e}function nt(t,e){this.a=t,this.c=e}Q.prototype.load=function(t){var e=new v,i=this.a,s=new G(this.c.api,d(i),this.c.text),n=this.c.families;!function(t,e){for(var i=e.length,s=0;s<i;s++){var n=e[s].split(":");3==n.length&&t.R.push(n.pop());var a="";2==n.length&&""!=n[1]&&(a=":"),t.o.push(n.join(a))}}(s,n);var a=new q(n);a.parse(),p(i,s.d(),_(e)),y(e,(function(){t(a.aa,a.I,tt)}))},et.prototype.B=function(t){var e=this.a;return d(this.a)+(this.c.api||"//f.fontdeck.com/s/css/js/")+(e.k.location.hostname||e.F.location.hostname)+"/"+t+".js"},et.prototype.load=function(t){var e=this.c.id,i=this.a.k,s=this;e?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[e]=function(e,i){for(var n=0,a=i.fonts.length;n<a;++n){var r=i.fonts[n];s.X.push(new R(r.name,O("font-weight:"+r.weight+";font-style:"+r.style)))}t(s.X)},g(this.a,this.B(e),(function(e){e&&t([])}))):t([])},it.prototype.B=function(t){return(this.c.api||"https://use.typekit.net")+"/"+t+".js"},it.prototype.load=function(t){var e=this.c.id,i=this.a.k;e?g(this.a,this.B(e),(function(e){if(e)t([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){e=i.Typekit.config.fn;for(var s=[],n=0;n<e.length;n+=2)for(var a=e[n],r=e[n+1],o=0;o<r.length;o++)s.push(new R(a,r[o]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}t(s)}}),2e3):t([])},st.prototype.B=function(t,e){return d(this.a)+"//"+(this.c.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"")+"/"+t+".js"+(e?"?v="+e:"")},st.prototype.load=function(t){function e(){if(n["__mti_fntLst"+i]){var s,a=n["__mti_fntLst"+i](),r=[];if(a)for(var o=0;o<a.length;o++){var h=a[o].fontfamily;null!=a[o].fontStyle&&null!=a[o].fontWeight?(s=a[o].fontStyle+a[o].fontWeight,r.push(new R(h,s))):r.push(new R(h))}t(r)}else setTimeout((function(){e()}),50)}var i=this.c.projectId,s=this.c.version;if(i){var n=this.a.k;g(this.a,this.B(i,s),(function(i){i?t([]):e()})).id="__MonotypeAPIScript__"+i}else t([])},nt.prototype.load=function(t){var e,i,s=this.c.urls||[],n=this.c.families||[],a=this.c.testStrings||{},r=new v;for(e=0,i=s.length;e<i;e++)p(this.a,s[e],_(r));var o=[];for(e=0,i=n.length;e<i;e++)if((s=n[e].split(":"))[1])for(var h=s[1].split(","),l=0;l<h.length;l+=1)o.push(new R(s[0],h[l]));else o.push(new R(s[0]));y(r,(function(){t(o,a)}))};var at=new j(window);at.q.t.custom=function(t,e){return new nt(e,t)},at.q.t.fontdeck=function(t,e){return new et(e,t)},at.q.t.monotype=function(t,e){return new st(e,t)},at.q.t.typekit=function(t,e){return new it(e,t)},at.q.t.google=function(t,e){return new Q(e,t)};var rt={load:r(at.load,at)};void 0===(s=function(){return rt}.call(e,i,e,t))||(t.exports=s)}()},function(t,e,i){t.exports=i(2)},function(t,e,i){"use strict";function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}i.r(e),i.d(e,"iEdit",(function(){return B}));var n=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.BOUNDBOX=!1,this.ORIENT_SIMPLE=!1,this.ORIENT_HORZ=0,this.ORIENT_VERT=1,this.ORIENT_VERT_MIX=2,this.ORIENT_COMMON_CHAR=",.;:()[]{}<>\"'",this.ORIENT_RADIAN=this.toRadian(90),this.MARGIN_H=5,this.ENTERKEY="¶",this.SPACEKEY=" ",this.TABKEY="µ",this.SUBSTITUTE="█",this.BLOCK_DISPLAY_NONE=-1,this.BLOCK_DISPLAY_KILLFOCUS=0,this.BLOCK_DISPLAY_FOCUS=1,this.RECORD_OFF=0,this.RECORD_INS=1,this.RECORD_COMP=2,this.RECORD_REPL=3,this.RECORD_DEL=4,this.RECORD_ATTR=5,this.RECORD_PARA=6,this.RECORD_VALIGN=7,this.RECORD_MARKER=8,this.CARET_DURATION=500,this.CARET_WIDTH=1.2,this.CARET_FRONT_COLOR="rgba(0, 0, 0, 0.5)",this.CARET_BACK_COLOR=null,this.COLOR_BLOCK="rgba(0, 0, 0, 0.5)",this.COLOR_BLOCK_KILLFOCUS="rgba(0, 0, 0, 0)",this.COLOR_TBOX_WARNING_FILL="rgba(255, 255, 0, 0.5)",this.DEFAULT_FONT_FACENAME="Nanum Gothic",this.PROHIBIT_ENABLE=!0,this.PROHIBIT_PRE=",.?!;:)]}>",this.PROHIBIT_POST="([{<",this.WORDWRAP=!0,this.HAN_WORD_CUT=!1,this.ENG_WORD_CUT=!0,this.LINEGAP_MIN=12,this.LINEAR_LINE=0,this.LINEAR_COLOR=1,this.LINEAR_MERGE=2,this.LINEAR_NOCUT=3,this.MARKER_ENABLE=!0,this.MERGE_MARK_COLOR="rgba(0, 0, 233, 1)",this.MERGE_BACK_COLOR="rgba(128, 128, 128, 0.5)",this.NOCUT_MARK_COLOR="rgba(233, 0, 0, 1)",this.NOCUT_BACK_COLOR="rgba(128, 128, 128, 0.5)"}var e,i,n;return e=t,(i=[{key:"isOrientCommonChar",value:function(t){return this.ENTERKEY==t||this.SPACEKEY==t||this.TABKEY==t||this.ORIENT_COMMON_CHAR.indexOf(t)>-1}},{key:"isDelimiter",value:function(t){return t==this.SPACEKEY||t==this.TABKEY}},{key:"isPreProhibit",value:function(t){return this.PROHIBIT_PRE.indexOf(t)>-1}},{key:"isPostProhibit",value:function(t){return this.PROHIBIT_POST.indexOf(t)>-1}},{key:"generateID",value:function(t){for(var e=0;e<1e6;e++)if(!t.hasOwnProperty(e))return e;return console.log("** ID table overflow.."),1e6}},{key:"pt2px",value:function(t){return parseInt(96*t/72)}},{key:"px2pt",value:function(t){return parseInt(72*t/96)}},{key:"replaceEscapeChar",value:function(t){var e=t;return e=e.replace(/"/gi,'\\"')}},{key:"getBaselineInfo",value:function(t,e){var i=document.createElement("div"),s=document.body;if(!i||!s)return{ascent:0,descent:0};i.style.position="absolute",i.style.whiteSpace="nowrap",i.style.fontFamily=t,i.style.fontSize=e+"pt",s.appendChild(i),i.innerHTML="Hg|Wjgm)";var n=i.offsetHeight,a=document.createElement("span");a.style.display="inline-block",a.style.overflow="hidden",a.style.width="1px",a.style.height="0px",i.appendChild(a);var r=a.offsetTop+a.offsetHeight;return i.removeChild(a),document.body.removeChild(i),a=null,i=null,{ascent:r,descent:n-r}}},{key:"isUndefined",value:function(t){return void 0===t}},{key:"isValidType",value:function(t){return void 0!==t&&null!=t}},{key:"isEqualRGBA",value:function(t,e){var i=this.getRGBA(t),s=this.getRGBA(e);return null!=i&&null!=s?i.r==s.r&&i.g==s.g&&i.b==s.b&&i.a==s.a:null==i&&null==s}},{key:"getRGBA",value:function(t){if(this.isValidType(t)){var e=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d*\.?\d*)[\s+]?\)/i);if(e&&5===e.length)return{r:e[1],g:e[2],b:e[3],a:e[4]};console.error("getRGBA error: "+t)}return null}},{key:"rgba2HexType",value:function(t){var e=this.getRGBA(t);return e?{hex:"#"+("0"+parseInt(e.r,10).toString(16)).slice(-2)+("0"+parseInt(e.g,10).toString(16)).slice(-2)+("0"+parseInt(e.b,10).toString(16)).slice(-2),alpha:e.a}:null}},{key:"hex2rgba",value:function(t,e){if(7!=t.length)return"rgb(255,255,255,1.0)";var i=parseInt(t.substr(1,2),16),s=parseInt(t.substr(3,2),16),n=parseInt(t.substr(5,2),16);return"rgba(".concat(i,",").concat(s,",").concat(n,",").concat(e,")")}},{key:"isAscii",value:function(t){var e=t.charCodeAt();return 32<=e&&e<=126||13==e||10==e||this.ENTERKEY==t||this.SUBSTITUTE==t}},{key:"isDBCS",value:function(t){var e=t.charCodeAt();return 4352<=e&&e<=4607||12592<=e&&e<=12687||44032<=e&&e<=55203||19968<=e&&e<=40959}},{key:"isHanja",value:function(t){var e=t.charCodeAt();return 19968<=e&&e<=40959}},{key:"toRadian",value:function(t){return t*Math.PI/180}},{key:"toAngle",value:function(t){return 180*t/Math.PI}}])&&s(e.prototype,i),n&&s(e,n),t}()),a=i(0),r=i.n(a);function o(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var h=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.job_queue=[],this.WEBFONT_DEFAULT="Nanum Gothic",this.WEBFONT_BASEURL="http://fonts.googleapis.com/earlyaccess/",this.WEBFONT_POOL=["Nanum Gothic","Nanum Myeongjo","Nanum Pen Script","Nanum Brush Script","Nanum Gothic Coding","Jeju Gothic","Jeju Myeongjo","Jeju Hallasan","KoPub Batang","Noto Sans KR","Hanna","Amstelvar"],this.WEBFONT_PATH={"Nanum Gothic":"nanumgothic.css","Nanum Myeongjo":"nanummyeongjo.css","Nanum Pen Script":"nanumpenscript.css","Nanum Brush Script":"nanumbrushscript.css","Nanum Gothic Coding":"nanumgothiccoding.css","Jeju Gothic":"jejugothic.css","Jeju Myeongjo":"jejumyeongjo.css","Jeju Hallasan":"jejuhallasan.css","KoPub Batang":"kopubbatang.css","Noto Sans KR":"notosanskr.css",Hanna:"hanna.css",Amstelvar:"amstelvaralpha.css"},this.WEBFONT_HANJA=["Nanum Gothic","KoPub Batang","Noto Sans KR"]}var e,i,s;return e=t,(i=[{key:"setDefault",value:function(t,e,i,s,n){this.WEBFONT_DEFAULT=t,this.WEBFONT_BASEURL=e,this.WEBFONT_POOL=i,this.WEBFONT_PATH=s,this.WEBFONT_HANJA=n}},{key:"getWebFont",value:function(t){for(var e in this.WEBFONT_POOL)if(t==this.WEBFONT_POOL[e])return t;return this.WEBFONT_DEFAULT}},{key:"loadWebFonts",value:function(t,e){if(!Array.isArray(t)){var i=t.split(",");if(i.length>1){t=[];for(var s=0;s<i.length;s++)t.push(i[s].trim())}}var n=[],a=[];if(Array.isArray(t))for(var r=0;r<t.length;r++){var o=this.getWebFont(t[r]),h=this.WEBFONT_BASEURL+this.WEBFONT_PATH[o];a.indexOf(o)<0&&(a.push(o),n.push(h))}else o=this.getWebFont(t),h=this.WEBFONT_BASEURL+this.WEBFONT_PATH[o],a.push(o),n.push(h);a.length>0&&a.length==n.length&&(this.job_queue.length<=0&&this.loadWebFontsProcess(a,n,e),this.job_queue.push({fonts:a,urls:n,func:e}))}},{key:"loadWebFontsProcess",value:function(t,e,i){var s=this;r.a.load({timeout:1e4*t.length,custom:{families:t,urls:e},active:function(){if(i(),s.job_queue.shift(),s.job_queue.length>0){var t=s.job_queue[0];s.loadWebFontsProcess(t.fonts,t.urls,t.func)}},inactive:function(){console.error("load webfont faile (inactive state) "+Date.now())}})}},{key:"isHanjaFont",value:function(t){for(var e=0;e<this.WEBFONT_HANJA.length;e++)if(t==this.WEBFONT_HANJA[e])return!0;return!1}}])&&o(e.prototype,i),s&&o(e,s),t}());function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function u(t,e,i){return e&&c(t.prototype,e),i&&c(t,i),t}var f=function(){function t(e,i){l(this,t),this.x=e,this.y=i}return u(t,[{key:"clone",value:function(){return new t(this.x,this.y)}}]),t}(),d=function(){function t(e,i,s,n){l(this,t),this.l=e,this.t=i,this.r=s,this.b=n}return u(t,[{key:"clone",value:function(){return new t(this.l,this.t,this.r,this.b)}},{key:"loadData",value:function(t){n.isValidType(t)&&(this.l=t.l,this.t=t.t,this.r=t.r,this.b=t.b)}},{key:"toJSON",value:function(){var t="{";return t+=' "l":'+this.l,t+=', "t":'+this.t,t+=', "r":'+this.r,t+=', "b":'+this.b,t+="}"}},{key:"isEqual",value:function(t){return!!n.isValidType(t)&&(this.l==t.l&&(this.t==t.t&&(this.r==t.r&&this.b==t.b)))}},{key:"width",value:function(){return this.r-this.l}},{key:"height",value:function(){return this.b-this.t}}]),t}(),p=function(){function t(){l(this,t),this.color="rgba(0, 0, 0, 1.0)",this.thickness=1,this.dashes=[]}return u(t,[{key:"clone",value:function(){var e=new t;return e.color=this.color,e.thickness=this.thickness,e.dashes=this.dashes,e}},{key:"loadData",value:function(t){n.isValidType(t)&&(this.color=t.color,this.thickness=t.thickness,this.dashes=t.dashes)}},{key:"toJSON",value:function(){var t="{";t+=' "color":"'+this.color+'"',t+=', "thickness":'+this.thickness,t+=', "dashes":[';for(var e=0;e<this.dashes.length;e++)t+=this.dashes[e],e<this.dashes.length-1&&(t+=",");return t+="]}"}},{key:"isEqual",value:function(t){if(!n.isValidType(t))return!1;if(!n.isEqualRGBA(this.color,t.color))return!1;if(this.thickness!=t.thickness)return!1;if(this.dashes.length!=t.dashes.length)return!1;for(var e=0;e<this.dashes.length;e++)if(this.dashes[e]!=t.dashes[e])return!1;return!0}}]),t}(),g=function(){function t(){l(this,t),this.color="rgba(0, 0, 0, 1.0)",this.xoffset=0,this.yoffset=0,this.blur=0}return u(t,[{key:"clone",value:function(){var e=new t;return e.color=this.color,e.xoffset=this.xoffset,e.yoffset=this.yoffset,e.blur=this.blur,e}},{key:"loadData",value:function(t){n.isValidType(t)&&(this.color=t.color,this.xoffset=t.xoffset,this.yoffset=t.yoffset,this.blur=t.blur)}},{key:"toJSON",value:function(){var t="{";return t+=' "color":"'+this.color+'"',t+=', "xoffset":'+this.xoffset,t+=', "yoffset":'+this.yoffset,t+=', "blur":'+this.blur,t+="}"}},{key:"isEqual",value:function(t){return!!n.isValidType(t)&&(!!n.isEqualRGBA(this.color,t.color)&&(this.xoffset==t.xoffset&&(this.yoffset==t.yoffset&&this.blur==t.blur)))}}]),t}(),v=function t(e){l(this,t),this.facename=e,this.point=e,this.textcolor=e,this.backcolor=e,this.bold=e,this.italic=e,this.charw=e,this.charg=e,this.wordg=e,this.underline=e,this.strikeout=e,this.strokeline=e,this.shadow=e,this.merge=e,this.nocut=e},_=function(){function t(){l(this,t),this.facename=n.DEFAULT_FONT_FACENAME,this.point=12,this.textcolor="rgba(0,0,0,1.0)",this.backcolor=null,this.bold=!1,this.italic=!1,this.charw=100,this.charg=0,this.wordg=100,this.underline=null,this.strikeout=null,this.strokeline=null,this.shadow=null,this.merge=-1,this.nocut=!1,this.ascent=0,this.descent=0}return u(t,[{key:"clone",value:function(){var e=new t;return e.facename=this.facename,e.point=this.point,e.textcolor=this.textcolor,e.backcolor=this.backcolor,e.bold=this.bold,e.italic=this.italic,e.charw=this.charw,e.charg=this.charg,e.wordg=this.wordg,e.underline=n.isValidType(this.underline)?this.underline.clone():null,e.strikeout=n.isValidType(this.strikeout)?this.strikeout.clone():null,e.strokeline=n.isValidType(this.strokeline)?this.strokeline.clone():null,e.shadow=n.isValidType(this.shadow)?this.shadow.clone():null,e.merge=this.merge,e.nocut=this.nocut,e.ascent=this.ascent,e.descent=this.descent,e}},{key:"loadData",value:function(t){this.facename=t.facename,this.point=t.point,this.textcolor=t.textcolor,this.backcolor=t.backcolor,this.bold=t.bold,this.italic=t.italic,this.charw=t.charw,this.charg=t.charg,this.wordg=t.wordg,this.underline=null,this.strikeout=null,this.strokeline=null,this.shadow=null,n.isValidType(t.underline)&&(this.underline=new p,this.underline.loadData(t.underline)),n.isValidType(t.strikeout)&&(this.strikeout=new p,this.strikeout.loadData(t.strikeout)),n.isValidType(t.strokeline)&&(this.strokeline=new p,this.strokeline.loadData(t.strokeline)),n.isValidType(t.shadow)&&(this.shadow=new g,this.shadow.loadData(t.shadow)),this.merge=n.isValidType(t.merge)?t.merge:-1,this.nocut=!!n.isValidType(t.nocut)&&t.nocut}},{key:"toJSON",value:function(){var t="  {";return t+='"facename":"'+this.facename+'"',t+=', "point":'+this.point,t+=', "textcolor":"'+this.textcolor+'"',t+=', "backcolor":'+(n.isValidType(this.backcolor)?'"'+this.backcolor+'"':null),t+=', "bold":'+this.bold,t+=', "italic":'+this.italic,t+=', "charw":'+this.charw,t+=', "charg":'+this.charg,t+=', "wordg":'+this.wordg,t+=', "underline":'+(n.isValidType(this.underline)?this.underline.toJSON():null),t+=', "strikeout":'+(n.isValidType(this.strikeout)?this.strikeout.toJSON():null),t+=', "strokeline":'+(n.isValidType(this.strokeline)?this.strokeline.toJSON():null),t+=', "shadow":'+(n.isValidType(this.shadow)?this.shadow.toJSON():null),t+=', "merge":'+this.merge,t+=', "nocut":'+this.nocut,t+="}"}},{key:"setProp",value:function(t,e){if(e.facename&&(this.facename=t.facename),e.point&&(this.point=t.point),e.textcolor&&(this.textcolor=t.textcolor),e.backcolor&&(this.backcolor=t.backcolor),e.bold&&(this.bold=t.bold),e.italic&&(this.italic=t.italic),e.charw&&(this.charw=t.charw),e.charg&&(this.charg=t.charg),e.wordg&&(this.wordg=t.wordg),e.underline&&(this.underline=n.isValidType(t.underline)?t.underline.clone():null),e.strikeout&&(this.strikeout=n.isValidType(t.strikeout)?t.strikeout.clone():null),e.strokeline&&(this.strokeline=n.isValidType(t.strokeline)?t.strokeline.clone():null),e.shadow&&(this.shadow=n.isValidType(t.shadow)?t.shadow.clone():null),e.merge&&(this.merge=t.merge),e.nocut&&(this.nocut=t.nocut),e.point||e.facename){var i=n.getBaselineInfo(this.facename,this.point);this.ascent=i.ascent,this.descent=i.descent}}},{key:"isEqual",value:function(t){return!!n.isValidType(t)&&(this.facename==t.facename&&(this.point==t.point&&(!!n.isEqualRGBA(this.textcolor,t.textcolor)&&(!!n.isEqualRGBA(this.backcolor,t.backcolor)&&(this.bold==t.bold&&(this.italic==t.italic&&(this.charw==t.charw&&(this.charg==t.charg&&(this.wordg==t.wordg&&((null!=this.underline||null==t.underline)&&((null!=this.strikeout||null==t.strikeout)&&((null!=this.strokeline||null==t.strokeline)&&((null!=this.shadow||null==t.shadow)&&(!(null!=this.underline&&!this.underline.isEqual(t.underline))&&(!(null!=this.strikeout&&!this.strikeout.isEqual(t.strikeout))&&(!(null!=this.strokeline&&!this.strokeline.isEqual(t.strokeline))&&(!(null!=this.shadow&&!this.shadow.isEqual(t.shadow))&&(this.merge==t.merge&&this.nocut==t.nocut))))))))))))))))))}}]),t}(),y=function(){function t(){l(this,t),this.array={}}return u(t,[{key:"clone",value:function(){var e=new t;for(var i in this.array)e.array[i]=this.array[i].clone();return e}},{key:"loadData",value:function(t){for(var e in this.array={},t){var i=parseInt(e);this.array[i]=new _,this.array[i].loadData(t[e])}}},{key:"toJSON",value:function(){var t=0,e=0;for(var i in this.array)e++;var s='"text_a": {\n';for(var n in this.array)s+='"'+n+'":',s+=this.array[n].toJSON(),t<e-1&&(s+=","),s+="\n",t++;return s+="}"}},{key:"addNoDup",value:function(t){var e=-1;for(var i in this.array)if(this.array[i].isEqual(t)){e=i,t=null;break}if(e<0){var s=n.getBaselineInfo(t.facename,t.point);t.ascent=s.ascent,t.descent=s.descent,e=n.generateID(this.array),this.array[e]=t}return e}}]),t}(),k=function t(e){l(this,t),this.align=e,this.linegap_unit=e,this.linegap_value=e,this.paragap=e,this.indent=e,this.tabsize=e},m=function(){function t(){l(this,t),this.align="left",this.linegap_unit="percent",this.linegap_value=120,this.paragap=new d(0,0,0,0),this.indent=0,this.tabsize=50}return u(t,[{key:"clone",value:function(){var e=new t;return e.align=this.align,e.linegap_unit=this.linegap_unit,e.linegap_value=this.linegap_value,e.paragap=this.paragap.clone(),e.indent=this.indent,e.tabsize=this.tabsize,e}},{key:"loadData",value:function(t){this.align=t.align,this.linegap_unit=t.linegap_unit,this.linegap_value=t.linegap_value,this.paragap=new d(0,0,0,0),this.paragap.loadData(t.paragap),this.indent=t.indent,this.tabsize=t.tabsize}},{key:"toJSON",value:function(){var t="  {";return t+='"align":"'+this.align+'"',t+=', "linegap_unit":"'+this.linegap_unit+'"',t+=', "linegap_value":'+this.linegap_value,t+=', "paragap":'+this.paragap.toJSON(),t+=', "indent":'+this.indent,t+=', "tabsize":'+this.tabsize,t+=" }"}},{key:"setProp",value:function(t,e){e.align&&(this.align=t.align),e.linegap_unit&&(this.linegap_unit=t.linegap_unit),e.linegap_value&&(this.linegap_value=t.linegap_value),e.paragap&&this.paragap.loadData(t.paragap),e.indent&&(this.indent=t.indent),e.tabsize&&(this.tabsize=t.tabsize)}},{key:"isEqual",value:function(t){return!!n.isValidType(t)&&(this.align==t.align&&(this.linegap_unit==t.linegap_unit&&(this.linegap_value==t.linegap_value&&(!!this.paragap.isEqual(t.paragap)&&(this.indent==t.indent&&this.tabsize==t.tabsize)))))}}]),t}(),R=function(){function t(){l(this,t),this.array={}}return u(t,[{key:"clone",value:function(){var e=new t;for(var i in this.array)e.array[i]=this.array[i].clone();return e}},{key:"addNoDup",value:function(t){var e=-1;for(var i in this.array)if(this.array[i].isEqual(t)){e=i,t=null;break}return e<0&&(e=n.generateID(this.array),this.array[e]=t),e}},{key:"toJSON",value:function(){var t=0,e=0;for(var i in this.array)e++;var s='"para_a": {\n';for(var n in this.array)s+='"'+n+'":',s+=this.array[n].toJSON(),t<e-1&&(s+=","),s+="\n",t++;return s+="}"}},{key:"loadData",value:function(t){for(var e in this.array={},t){var i=parseInt(e);this.array[i]=new m,this.array[i].loadData(t[e])}}}]),t}(),b=function(){function t(){l(this,t),this.inspos=-1,this.attrid=-1}return u(t,[{key:"reset",value:function(){this.inspos=-1,this.attrid=-1}},{key:"clone",value:function(){var e=new t;return e.inspos=this.inspos,e.attrid=this.attrid,e}},{key:"setState",value:function(t,e){this.inspos=t,this.attrid=e}},{key:"getInsPos",value:function(){return this.inspos}},{key:"getAttrID",value:function(){return this.attrid}}]),t}(),E=function(){function t(e,i){l(this,t),this.pivot=e,this.move=i}return u(t,[{key:"init",value:function(){this.pivot=0,this.move=0}},{key:"clone",value:function(){var e=new t(0,0);return e.pivot=this.pivot,e.move=this.move,e}},{key:"isEqual",value:function(t){return!!n.isValidType(t)&&(this.pivot==t.pivot&&this.move==t.move)}},{key:"isBlock",value:function(){return!(this.pivot<0||this.move<0)&&this.pivot!=this.move}},{key:"setPos",value:function(t){this.pivot=t,this.move=t}},{key:"getPivot",value:function(){return this.pivot}},{key:"getMove",value:function(){return this.move}},{key:"setPivot",value:function(t){this.pivot=t}},{key:"setMove",value:function(t){this.move=t}},{key:"getLeft",value:function(){return this.pivot<=this.move?this.pivot:this.move}},{key:"getRight",value:function(){return this.pivot>this.move?this.pivot:this.move}},{key:"setLeft",value:function(){var t=this.pivot<=this.move?this.pivot:this.move;this.pivot=this.move=t}},{key:"setRight",value:function(){var t=this.pivot>this.move?this.pivot:this.move;this.pivot=this.move=t}},{key:"moveLeft",value:function(t){if(this.isBlock())this.setLeft();else{if(this.pivot<=t)return!1;this.pivot--,this.move=this.pivot}return!0}},{key:"moveRight",value:function(t){if(this.isBlock())this.setRight();else{if(this.pivot>=t)return!1;this.pivot++,this.move=this.pivot}return!0}},{key:"moveBlockLeft",value:function(t){return!(this.move<=t)&&(this.move--,!0)}},{key:"moveBlockRight",value:function(t){return!(this.move>=t)&&(this.move++,!0)}},{key:"getBlock",value:function(){return this.isBlock()?{left:this.pivot<=this.move?this.pivot:this.move,right:(this.pivot>this.move?this.pivot:this.move)-1,move:this.move}:{left:-1,right:-1,move:this.move}}},{key:"setBlock",value:function(t,e){return!(t<0||e<0)&&(this.pivot=t,this.move=e,this.pivot<this.move)}}]),t}(),w=function(){function t(){if(l(this,t),this.visible=!1,this.base_x=0,this.rect=new d(0,0,0,0),this.rect_prev=null,this.blink=!0,n.CARET_DURATION>100){var e=this;setInterval((function(){e.blink=!e.blink}),n.CARET_DURATION)}}return u(t,[{key:"isShow",value:function(){return this.visible}},{key:"show",value:function(t){this.visible=t}},{key:"getBaseX",value:function(){return this.base_x}},{key:"setBaseX",value:function(t){this.base_x=t}},{key:"getRect",value:function(){return this.rect.clone()}},{key:"setRect",value:function(t){this.rect=null,this.rect=t.clone()}},{key:"display",value:function(t,e,i,s){0!=this.visible&&(t.save(),s||this.blink||!this.rect.isEqual(this.rect_prev)?(t.fillStyle=n.CARET_FRONT_COLOR,t.fillRect(this.rect.l+e,this.rect.t+i,this.rect.width(),this.rect.height())):null!=n.CARET_BACK_COLOR&&(t.fillStyle=n.CARET_BACK_COLOR,t.fillRect(this.rect.l+e,this.rect.t+i,this.rect.width(),this.rect.height())),this.rect_prev=this.rect,t.restore())}}]),t}(),O=function t(e,i,s,n){l(this,t),this.type=e,this.pos=i,this.del=s,this.ins=n};function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function C(t,e,i){return e&&T(t.prototype,e),i&&T(t,i),t}var D=function(){function t(){x(this,t),this.code="",this.width=0,this.ascent=0,this.descent=0,this.x=0,this.y=0,this.char_g=0,this.step_g=0}return C(t,[{key:"clone",value:function(){var e=new t;return e.code=this.code,e.width=this.width,e.ascent=this.ascent,e.descent=this.descent,e.x=this.x,e.y=this.y,e.char_g=this.char_g,e.step_g=this.step_g,e}}]),t}(),N=function t(){x(this,t),this.begin=0,this.end=0,this.total_w=0,this.remain_w=0,this.max_ascent=0,this.max_descent=0,this.start_x=0,this.top_h=0,this.bottom_h=0,this.is_firstline=!0,this.is_lastline=!0,this.ci_array=null},A=function(){function t(){x(this,t),this.array=new Array}return C(t,[{key:"pos2LineIndex",value:function(t){if(this.array.length<=0)return-1;for(var e=0;e<this.array.length;e++){var i=this.array[e];if(t>=i.begin&&t<=i.end)return e}return-1}},{key:"point2LineIndex",value:function(t){if(this.array.length<=0)return-1;for(var e=0,i=0;i<this.array.length;i++){var s=this.array[i],n=s.top_h+s.max_ascent+s.max_descent+s.bottom_h;if(t<e+n)return i;e+=n}return this.array.length-1}},{key:"getTotalHeight",value:function(){for(var t=0,e=0,i=0;i<this.array.length;i++){var s=this.array[i];t+=s.top_h+s.max_ascent+s.max_descent+s.bottom_h,e=s.bottom_h}return e<0&&(t-=e),t}},{key:"getLineRect",value:function(t,e){if(this.array.length<=0)return new d(0,0,0,0);if(t<0)return new d(0,0,0,0);if(t>=this.array.length)return new d(0,0,0,0);for(var i=0,s=0,n=new d(0,0,0,0),a=0;a<this.array.length;a++){var r=this.array[a];if(n.r=n.l+(r.total_w-r.remain_w),n.b=n.t+(r.top_h+r.max_ascent+r.max_descent+r.bottom_h),i=r.top_h,s=r.bottom_h,a==t)break;n.t=n.b}return e||(n.t+=i,n.b-=s),n}}]),t}(),P=function(){function t(e){x(this,t),this.orient=e||n.ORIENT_HORZ,this.textstr=[],this.offsets=[],this.text_a=new y,this.para_a=new R,this.lines=new A,this.sel_state=new b,this.textstr.push(n.ENTERKEY),this.offsets.push(0),this.text_a.array[0]=new _,this.para_a.array[0]=new m}return C(t,[{key:"clone",value:function(){var e=new t;return e.orient=this.orient,e.textstr=this.textstr.slice(0),e.offsets=this.offsets.slice(0),e.text_a=this.text_a.clone(),e.para_a=this.para_a.clone(),e}},{key:"setOrient",value:function(t){this.orient=t}},{key:"loadData",value:function(t,e){if(this.orient=t.orient,n.isValidType(e)&&1==e){for(var i=[],s=0;s<t.textstr.length;s++){var a=t.textstr.charAt(s);i.push(a)}i.push(n.ENTERKEY),this.textstr=i}else this.textstr=t.textstr;this.offsets=t.offsets,this.text_a.loadData(t.text_a),this.para_a.loadData(t.para_a)}},{key:"toJSON",value:function(t){var e="{\n";if(e+='"orient": '+this.orient+",\n",n.isValidType(t)&&1==t)e+='"textstr": \n"',e+=this.toString(),e+='",\n';else{e+='"textstr": [\n';for(var i=0;i<this.textstr.length;i++){e+='"'+n.replaceEscapeChar(this.textstr[i])+'"',i<this.textstr.length-1&&(e+=",")}e+="],\n"}e+='"offsets": [\n';for(i=0;i<this.offsets.length;i++)e+=this.offsets[i],i<this.offsets.length-1&&(e+=",");return e+="],\n",e+=this.text_a.toJSON()+",\n",e+=this.para_a.toJSON()+"\n",e+="}\n"}},{key:"toString",value:function(){for(var t="",e=0;e<this.textstr.length-1;e++)t+=this.textstr[e];return t=n.replaceEscapeChar(t)}},{key:"makeCoordinatesJSON",value:function(t,e){for(var i='"coordinates": [\n',s=e+n.MARGIN_H,a=0;a<this.lines.array.length;){for(var r=this.lines.array[a++],o=r.begin;o<=r.end;){var h=r.ci_array[o-r.begin],l=h.x,c=s+h.y,u=h.width,f=h.ascent+h.descent,d=h.ascent;i+="{ ",i+='"x": '+l.toFixed(2)+", ",i+='"y": '+c.toFixed(2)+", ",i+='"w": '+u.toFixed(2)+", ",i+='"h": '+f.toFixed(2)+", ",i+='"b": '+d.toFixed(2),i+="}",++o<this.textstr.length&&(i+=","),i+="\n"}s+=r.top_h+r.max_ascent+r.max_descent+r.bottom_h}return i+="]"}},{key:"deleteUnused",value:function(){var t={},e={};for(var i in this.text_a.array)t[i]=0;for(var i in this.para_a.array)e[i]=0;for(i=0;i<this.offsets.length;i++){var s=this.offsets[i];this.textstr[i]==n.ENTERKEY?e[s]=1:t[s]=1}for(var i in t[0]=e[0]=1,this.text_a.array)0==t[i]&&delete this.text_a.array[i];for(var i in this.para_a.array)0==e[i]&&delete this.para_a.array[i]}},{key:"setDefault",value:function(t,e){null!=t&&(this.text_a.array[0]=null,this.text_a.array[0]=t),null!=e&&(this.para_a.array[0]=null,this.para_a.array[0]=e)}},{key:"getLength",value:function(){return this.textstr.length-1}},{key:"getDocHeight",value:function(){return this.lines.getTotalHeight()+2*n.MARGIN_H}},{key:"getDocWidth",value:function(){return 0<this.lines.array.length?this.lines.array[0].total_w:0}},{key:"getAlignedWidth",value:function(){if(this.lines.array.length>0){var t=this.lines.array[0];return t.total_w-t.remain_w}return 0}},{key:"insertChars",value:function(t,e,i,s){if(t<0||t>=this.textstr.length)return{result:!1,replaced:null};var a=null;if(e[0]==n.ENTERKEY&&1==i){var r=this.getPara(t-1),o=null!=r?r.clone():new m,h=n.generateID(this.para_a.array);this.para_a.array[h]=o,this.textstr.splice(t,0,n.ENTERKEY),this.offsets.splice(t,0,h)}else if(s&&1==i&&t<this.textstr.length-1&&this.textstr[t]!=n.ENTERKEY)a=this.textstr[t],this.textstr[t]=e[0];else{var l=0;l=t==this.sel_state.getInsPos()?this.sel_state.getAttrID():this.getAttrID(t-1);for(var c=t,u=0;u<i;u++)this.textstr.splice(c,0,e[u]),this.offsets.splice(c,0,l),c++}return t!=this.sel_state.getInsPos()&&this.sel_state.reset(),{result:!0,replaced:a}}},{key:"insertDoc",value:function(t,e){if(t<0||t>=this.textstr.length)return!1;var i=e.clone(),s={};for(var a in i.text_a.array)s[a]=this.text_a.addNoDup(i.text_a.array[a]);var r={};for(var a in i.para_a.array){var o=n.generateID(this.para_a.array);this.para_a.array[o]=i.para_a.array[a],r[a]=o}for(a=0;a<i.offsets.length;a++){var h=i.offsets[a];i.textstr[a]==n.ENTERKEY?i.offsets[a]=r[h]:i.offsets[a]=s[h]}var l=t;for(a=0;a<i.textstr.length;a++)this.textstr.splice(l,0,i.textstr[a]),this.offsets.splice(l,0,i.offsets[a]),l++;this.deleteUnused()}},{key:"deleteChars",value:function(t,e){return!(t<0||t+e>this.getLength())&&(this.textstr.splice(t,e),this.offsets.splice(t,e),t!=this.sel_state.getInsPos()&&this.sel_state.reset(),e>2&&this.deleteUnused(),!0)}},{key:"getBlockDoc",value:function(e,i){if(e>=0&&e<=i&&i<this.textstr.length-1){var s=new t;s.textstr=this.textstr.slice(e,i+1),s.offsets=this.offsets.slice(e,i+1);for(var a=e;a<i+1;a++){var r=this.offsets[a];this.textstr[a]==n.ENTERKEY?s.para_a.array[r]=this.para_a.array[r].clone():s.text_a.array[r]=this.text_a.array[r].clone()}return s}return null}},{key:"getBlockText",value:function(t,e){return t>=0&&t<e&&e<this.textstr.length?this.textstr.slice(t,e+1).join(""):""}},{key:"getAttrID",value:function(t){for(;t>=0;){if(this.textstr[t]!=n.ENTERKEY)break;t--}return t<0?0:this.offsets[t]}},{key:"getParaID",value:function(t){for(;t>=0;){if(this.textstr[t]==n.ENTERKEY)break;t--}return t<0?0:this.offsets[t]}},{key:"getAttr",value:function(t){var e=this.getAttrID(t);return this.text_a.array.hasOwnProperty(e)?this.text_a.array[e]:null}},{key:"getPara",value:function(t){var e=this.getParaID(t);return this.para_a.array.hasOwnProperty(e)?this.para_a.array[e]:null}},{key:"getAttrState",value:function(t){if(t>=0&&t<this.textstr.length){var e=this.getAttr(t-1);if(e)return{attr:e.clone(),filter:new v(!0)}}return{attr:null,filter:null}}},{key:"getParaState",value:function(t){if(t>=0&&t<this.textstr.length){var e=this.getPara(t-1);if(e)return{para:e.clone(),filter:new k(!0)}}return{para:null,filter:null}}},{key:"getBlockAttrState",value:function(t,e){if(t>=0&&t<=e&&e<this.textstr.length){var i=this.getAttr(t);if(i){for(var s=i.clone(),a=new v(!0),r=t+1;r<=e;r++){var o=this.getAttr(r);i.facename!=o.facename&&(a.facename=!1),i.point!=o.point&&(a.point=!1),n.isEqualRGBA(i.textcolor,o.textcolor)||(a.textcolor=!1),n.isEqualRGBA(i.backcolor,o.backcolor)||(a.backcolor=!1),i.bold!=o.bold&&(a.bold=!1),i.italic!=o.italic&&(a.italic=!1),i.charw!=o.charw&&(a.charw=!1),i.charg!=o.charg&&(a.charg=!1),i.wordg!=o.wordg&&(a.wordg=!1),i.underline&&i.underline.isEqual(o.underline)||(a.underline=!1),i.strikeout&&i.strikeout.isEqual(o.strikeout)||(a.strikeout=!1),i.strokeline&&i.strokeline.isEqual(o.strokeline)||(a.strokeline=!1),i.shadow&&i.shadow.isEqual(o.shadow)||(a.shadow=!1),!i.nocut!=!o.nocut&&(a.nocut=!1)}return{attr:s,filter:a}}}return{attr:null,filter:null}}},{key:"getBlockParaState",value:function(t,e){if(t>=0&&t<=e&&e<this.textstr.length){var i=this.getPara(t);if(i){for(var s=i.clone(),a=new k(!0),r=t+1;r<=e;r++){if(this.textstr[r]==n.ENTERKEY){var o=this.getPara(r);i.align!=o.align&&(a.align=!1),i.linegap!=o.linegap&&(a.linegap=!1),i.paragap&&i.paragap.isEqual(o.paragap)||(a.paragap=!1),i.indent!=o.indent&&(a.indent=!1),i.tabsize!=o.tabsize&&(a.tabsize=!1)}}return{para:s,filter:a}}}return{para:null,filter:null}}},{key:"setAttrState",value:function(t,e,i){if(t<0||t>this.textstr.length)return!1;if(null==e)return!1;var s=null;if(i){var n=this.getAttr(t-1);n&&(s=n.clone()).setProp(e,i)}else s=e.clone();var a=this.text_a.addNoDup(s);return this.sel_state.setState(t,a),!0}},{key:"setParaState",value:function(t,e,i){if(t<0||t>this.textstr.length)return!1;if(null==e)return!1;var s=this.getPara(t-1);return!!s&&(s.setProp(e,i),!0)}},{key:"setBlockAttrState",value:function(t,e,i,s){if(t<0||t>e||e>=this.textstr.length-1)return!1;if(null==i)return!1;if(s)for(var a=new Array,r=new Array,o=t;o<=e;o++){if(this.textstr[o]!=n.ENTERKEY){for(var h=this.offsets[o],l=!1,c=0;c<a.length;c++)if(h==r[c]){var u=r[c];this.offsets[o]=u,l=!0;break}if(!l){(f=this.text_a.array[h].clone()).setProp(i,s);u=this.text_a.addNoDup(f);this.offsets[o]=u,a.push(h),r.push(u)}}}else{var f=i.clone(),d=this.text_a.addNoDup(f);for(o=t;o<=e;o++){this.textstr[o]!=X.ENTERKEY&&(this.offsets[o]=d)}}return!0}},{key:"setBlockParaState",value:function(t,e,i,s){if(t<0||t>e||e>=this.textstr.length-1)return!1;if(null==i)return!1;if(this.setParaState(t,i,s)){for(var a=t;a<=e;a++){if(this.textstr[a]==n.ENTERKEY){var r=this.offsets[a];if(this.para_a.array.hasOwnProperty(r))this.para_a.array[r].setProp(i,s)}}return!0}return!1}},{key:"getSelParas",value:function(t,e){if(!(t<0)){var i=[],s=this.getPara(t-1);if(s){i.push(s.clone());for(var a=t;a<=e;a++)if(this.textstr[a]==n.ENTERKEY){var r=this.offsets[a];this.para_a.array.hasOwnProperty(r)&&(s=this.para_a.array[r])&&i.push(s.clone())}return i}return null}}},{key:"setSelParas",value:function(t,e,i){if(!(t<0)){var s=new k(!0);if(this.setParaState(t,i[0],s))for(var a=1,r=t;r<=e;r++){if(this.textstr[r]==n.ENTERKEY){var o=this.offsets[r];if(this.para_a.array.hasOwnProperty(o))this.para_a.array[o].setProp(i[a],s);a++}}}}},{key:"setFontDC",value:function(t,e){if(this.text_a.array.hasOwnProperty(e)){var i=this.text_a.array[e];if(i){var s=i.bold?"bold ":"";s+=i.italic?"italic ":"",t.font=s+i.point+"pt '"+i.facename+"'",t.textAlign="left",t.textBaseline="alphabetic"}}}},{key:"getCodeInfo",value:function(t,e,i,s,a){var r=this.getAttrID(e);this.prev_attr_id!=r&&(this.setFontDC(t,r),this.prev_attr_id=r);var o=this.getAttr(e);if(o){var h=t.measureText(i);if(s.x=0,s.y=0,s.code=i,s.width=h.width*o.charw/100,!a||o.ascent<=0||o.descent<=0){var l=n.getBaselineInfo(o.facename,o.point);o.ascent=l.ascent,o.descent=l.descent}s.ascent=o.ascent,s.descent=o.descent,100!=o.wordg&&i==n.SPACEKEY&&(s.width=s.width*o.wordg/100),0!=o.charg&&(s.char_g=s.width*o.charg/100,this.orient!=n.ORIENT_VERT||n.isOrientCommonChar(s.code)?this.orient==n.ORIENT_VERT_MIX&&n.isDBCS(s.code)&&(s.char_g=(s.ascent+s.descent)*o.charg/100):s.char_g=(s.ascent+s.descent)*o.charg/100),i==n.ENTERKEY&&(s.width=0,s.char_g=0)}}},{key:"prohibitProcess",value:function(t,e,i){if(n.isPostProhibit(this.textstr[t])){for(var s=t;n.isPostProhibit(this.textstr[s]);)if(--s<=e){s=t;break}for(;s<t;)i.ci_array.pop(),t--}return t}},{key:"alignDoc",value:function(t,e,i){if(!(this.textstr.length<=0)){0==n.WORDWRAP&&(e=Number.MAX_VALUE),t.save(),this.setFontDC(t,0),this.prev_attr_id=0,this.lines=null,this.lines=new A;for(var s=0,a=!0;;){var r=this.alignLine(t,e,s,a,i);if(null==r||r.char_next>=this.textstr.length)break;s=r.char_next,a=r.is_firstline}for(var o=0;o<this.lines.array.length;){var h=this.lines.array[o++];this.alignLineXY(h)}return t.restore(),o+1}}},{key:"alignLine",value:function(t,e,i,s,a){var r=this.getPara(i);if(null!=r){e-=n.pt2px(r.paragap.l+r.paragap.r),e-=s?n.pt2px(r.indent):0;var o=new N;o.begin=i,o.end=i,o.total_w=e,o.remain_w=e,o.max_ascent=0,o.max_descent=0,o.start_x=n.pt2px(r.paragap.l)+(s?n.pt2px(r.indent):0),o.top_h=0,o.bottom_h=0,o.is_firstline=s,o.is_lastline=!1,o.ci_array=new Array;for(var h=i,l=i,c=0,u=0,f=!1,d=o.start_x-n.pt2px(r.paragap.l),p=n.pt2px(r.tabsize);h<this.textstr.length;){var g=this.textstr[h],v=this.getAttr(h),_=new D;if(this.getCodeInfo(t,h,g,_,a),o.ci_array.push(_),g==n.TABKEY){var y=(d+c+u)%p;_.width=p-y,_.char_g=0}var k=_.char_g,m=_.width;if(this.orient!=n.ORIENT_VERT||n.isOrientCommonChar(_.code)?this.orient==n.ORIENT_VERT_MIX&&n.isDBCS(_.code)&&(m=_.ascent+_.descent):m=_.ascent+_.descent,u+=m+k,0==v.nocut&&n.isDelimiter(g)?(l=h,c+=u,u=0):1==f&&(l=h-1,c+=u-(m+k),u=m+k),g==n.ENTERKEY||h>=this.textstr.length-1){l=h,o.is_lastline=!0;break}if(c+u>e){if(h==i){c=e,l=h;break}l==i&&(c=u-(m+k),l=h-1);for(var R=h;R>l;)o.ci_array.pop(),R--;break}h++,f=!1;var b=this.getAttr(h);if(v.nocut!=b.nocut)f=!0;else if(0==v.nocut){var E=n.isDBCS(g),w=n.isDBCS(this.textstr[h]);E!=w?f=!0:(n.HAN_WORD_CUT||E&&w&&(f=!0),n.ENG_WORD_CUT||E||w||(f=!0))}}for(var O=l+1;O<this.textstr.length&&this.textstr[O]==n.SPACEKEY;){if((b=this.getAttr(O))&&b.nocut)break;var x=_.clone();o.ci_array.push(x),O++}if(l=O-1,o.end=l,this.orient==n.ORIENT_VERT){o.max_descent=0;for(var T=0;T<o.ci_array.length;T++){x=o.ci_array[T];n.isOrientCommonChar(x.code)?(o.max_ascent<x.ascent&&(o.max_ascent=x.ascent),o.max_descent<x.descent&&(o.max_descent=x.descent)):o.max_ascent<x.ascent&&(o.max_ascent=x.width)}}else if(this.orient==n.ORIENT_VERT_MIX){o.max_descent=0;for(T=0;T<o.ci_array.length;T++){x=o.ci_array[T];n.isDBCS(x.code)?o.max_ascent<x.ascent&&(o.max_ascent=x.width):(o.max_ascent<x.ascent&&(o.max_ascent=x.ascent),o.max_descent<x.descent&&(o.max_descent=x.descent))}}else for(T=0;T<o.ci_array.length;T++){x=o.ci_array[T];o.max_ascent<x.ascent&&(o.max_ascent=x.ascent),o.max_descent<x.descent&&(o.max_descent=x.descent)}var C=o.max_ascent+o.max_descent,A=C;if("percent"==r.linegap_unit)A=C*r.linegap_value/100;else if("point"==r.linegap_unit){var P=r.linegap_value;P<n.LINEGAP_MIN&&(P=n.LINEGAP_MIN),A=n.pt2px(P)}return o.bottom_h=parseInt(A-C),o.is_lastline&&0!=r.paragap.b&&(o.bottom_h+=n.pt2px(r.paragap.b)),o.is_firstline&&0!=r.paragap.t&&(o.top_h=n.pt2px(r.paragap.t)),this.lines.array.push(o),{char_next:l+1,is_firstline:o.is_lastline}}}},{key:"alignLineXY",value:function(t){if(!(t.begin>t.end)){var e=this.getPara(t.begin);if(null!=e){for(var i=t.ci_array.length-1;i>=0&&t.ci_array[i].code==n.SPACEKEY;)i--;for(var s=0,a=0,r=0;r<=i;r++){var o=t.ci_array[r];n.isDelimiter(o.code)&&s++;var h=o.width;this.orient!=n.ORIENT_VERT||n.isOrientCommonChar(o.code)?this.orient==n.ORIENT_VERT_MIX&&n.isDBCS(o.code)&&(h=o.ascent+o.descent):h=o.ascent+o.descent,a+=h+o.char_g}t.remain_w=t.total_w-a,t.ci_array[i].char_g>0&&(t.remain_w+=t.ci_array[i].char_g);var l=0,c=0,u=t.top_h+t.max_ascent,f=0;switch(e.align){case"left":break;case"right":f=t.remain_w;break;case"center":f=t.remain_w/2;break;case"scattering":if(t.ci_array.length<=1||t.is_lastline&&t.ci_array.length<=2)f=t.remain_w/2;else{var d=t.ci_array.length-1;1==t.is_lastline&&d--,l=t.remain_w/d}break;case"justify":s>0&&(c=t.remain_w/s)}f+=n.pt2px(e.paragap.l),t.is_firstline&&(f+=n.pt2px(e.indent));for(r=0;r<=i;r++){(o=t.ci_array[r]).x=f,o.y=u-o.ascent;h=o.width;switch(this.orient!=n.ORIENT_VERT||n.isOrientCommonChar(o.code)?this.orient==n.ORIENT_VERT_MIX&&n.isDBCS(o.code)&&(h=o.ascent+o.descent):h=o.ascent+o.descent,e.align){case"left":case"right":case"center":o.step_g=h+o.char_g,f+=o.step_g;break;case"scattering":o.step_g=h+o.char_g+l,f+=o.step_g;break;case"justify":o.step_g=h+o.char_g,n.isDelimiter(o.code)&&!t.is_lastline&&(o.step_g+=c),f+=o.step_g}}for(r=i+1;r<t.ci_array.length;r++){(o=t.ci_array[r]).x=f,o.y=u-o.ascent}}}}},{key:"display",value:function(t,e,i,s,a,r,o){if(!(this.textstr.length<=0)){t.save(),this.setFontDC(t,0),this.prev_attr_id=0;for(var h=i+s,l=e,c=n.MARGIN_H+i,u=0;u<this.lines.array.length;){var f=this.lines.array[u++],d=f.top_h+f.max_ascent+f.max_descent+f.bottom_h;if(o?c+d>0&&this.displayLine(t,l,c,f,a,r):this.displayLine(t,l,c,f,a,r),c+=d,o&&c>h)break}t.restore()}}},{key:"displayLine",value:function(t,e,i,s,a,r){if(!(s.begin>s.end)){for(var o=-1,h=null,l=s.begin;l<=s.end;){if((E=this.textstr[l])!=n.ENTERKEY){var c=this.getAttrID(l),u=this.text_a.array[c],f=s.ci_array[l-s.begin],d=i+s.top_h,p=s.max_ascent+s.max_descent;o=this.displayLinearProp(n.LINEAR_COLOR,t,l,f,s,a,u.backcolor,h,o,d,p),h=u.backcolor}l++}var g=-1,v=null,_=-1,y=null,k=-1,m=null,R=-1,b=-1;for(l=s.begin;l<=s.end;){var E;f=s.ci_array[l-s.begin];if(l==a.left&&(R=f.x),l==a.right&&(b=f.x+f.step_g),(E=this.textstr[l])==n.ENTERKEY){var w=t.fillStyle;t.fillStyle="gray",t.fillText(E,f.x,i+f.y+f.ascent),t.fillStyle=w}else if(E==n.TABKEY);else{c=this.getAttrID(l);this.prev_attr_id!=c&&(this.setFontDC(t,c),this.prev_attr_id=c);u=this.text_a.array[c];if(t.save(),t.translate(f.x,i+f.y),this.orient==n.ORIENT_VERT_MIX){if(n.isDBCS(f.code)){var O=f.ascent+f.descent;t.translate(O/2-f.width/2,f.width/2-O/2),t.translate(f.width/2,O/2),t.rotate(-90*Math.PI/180),t.translate(-f.width/2,-O/2)}}else if(this.orient==n.ORIENT_VERT)if(n.isOrientCommonChar(f.code)){T=(s.max_ascent+s.max_descent)/2-(f.ascent+f.descent)/2;t.translate(0,-f.y+T)}else{var x=(O=f.ascent+f.descent)/2-f.width/2,T=(s.max_ascent+s.max_descent)/2-O/2;t.translate(x,-f.y+T),t.translate(f.width/2,O/2),t.rotate(-90*Math.PI/180),t.translate(-f.width/2,-O/2)}null!=u.shadow&&(t.shadowColor=u.shadow.color,t.shadowOffsetX=u.shadow.xoffset,t.shadowOffsetY=u.shadow.yoffset,t.shadowBlur=u.shadow.blur),t.fillStyle=u.textcolor,t.fillText(E,0,f.ascent,f.width),null!=u.strokeline&&(null!=u.shadow&&(t.shadowColor="",t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0),t.strokeStyle=u.strokeline.color,t.lineWidth=u.strokeline.thickness,2==u.strokeline.dashes.length&&t.setLineDash(u.strokeline.dashes),t.strokeText(E,0,f.ascent,f.width)),null!=u.strikeout&&(t.lineWidth=u.strikeout.thickness,t.strokeStyle=u.strikeout.color,2==u.strikeout.dashes.length&&t.setLineDash(u.strikeout.dashes),t.beginPath(),t.moveTo(0,f.ascent/2),t.lineTo(f.width,f.ascent/2),t.stroke()),n.BOUNDBOX&&(t.beginPath(),t.rect(0,0,f.width,f.ascent+f.descent),t.moveTo(0,f.ascent),t.lineTo(f.width,f.ascent),t.stroke()),t.restore();var C=i+s.top_h+s.max_ascent+s.max_descent;g=this.displayLinearProp(n.LINEAR_LINE,t,l,f,s,a,u.underline,v,g,C,-1),v=u.underline;d=i+s.top_h,p=s.max_ascent+s.max_descent;var D=null;u.merge>=0&&(D=u.merge),_=this.displayLinearProp(n.LINEAR_MERGE,t,l,f,s,a,D,y,_,d,p),y=D;var N=null;1==u.nocut&&(N=u.nocut),k=this.displayLinearProp(n.LINEAR_NOCUT,t,l,f,s,a,N,m,k,d,p),m=N}l++}r!=n.BLOCK_DISPLAY_NONE&&(s.begin>=a.left&&s.begin<=a.right||s.end>=a.left&&s.begin<=a.right)&&(R<0&&(R=e+s.start_x),b<0&&(b=e+s.start_x+s.total_w),t.save(),t.fillStyle=r==n.BLOCK_DISPLAY_FOCUS?n.COLOR_BLOCK:n.COLOR_BLOCK_KILLFOCUS,t.fillRect(R,i+s.top_h,b-R,s.max_ascent+s.max_descent+s.bottom_h),t.restore())}}},{key:"isLinearPropEnd",value:function(t,e,i){if(null==e)return!0;if(null!=i){if(t==n.LINEAR_LINE)return!e.isEqual(i);if(t==n.LINEAR_COLOR)return!n.isEqualRGBA(e,i);if(t==n.LINEAR_MERGE||t==n.LINEAR_NOCUT)return e!=i}return!1}},{key:"displayLinearProp",value:function(t,e,i,s,a,r,o,h,l,c,u){if(null!=o&&l<0&&(l=s.x),l>=0){var f=!1,d=-1,p=-1;if(this.isLinearPropEnd(t,o,h)?(d=null==o?-1:s.x,p=s.x,f=!0):(i>=a.end||a.is_lastline&&this.textstr[i+1]==n.ENTERKEY)&&(p=s.x+s.width,f=!0),p>=0){if(this.isLinearPropEnd(t,o,h)&&(o=h),null!=o){if(e.save(),t==n.LINEAR_LINE)e.lineWidth=o.thickness,e.strokeStyle=o.color,2==o.dashes.length&&e.setLineDash(o.dashes),e.beginPath(),e.moveTo(l,c),e.lineTo(p,c),e.stroke();else if(t==n.LINEAR_COLOR)e.fillStyle=o,e.fillRect(l,c,p-l,u);else if(t==n.LINEAR_MERGE){var g=o,v=this.isInMarkerRange(i-1,r)?n.MERGE_BACK_COLOR:null;this.displayMarker(e,l,c,p-l,u,g,f,n.MERGE_MARK_COLOR,v)}else if(t==n.LINEAR_NOCUT){g=o;this.displayMarker(e,l,c,p-l,u,g,f,n.NOCUT_MARK_COLOR,null)}e.restore()}l=d}}return l}},{key:"isInMarkerRange",value:function(t,e){var i=this.getMailMergeRange(t);if(null!=i){var s=e.move-1;return i.lpos<=s&&s<=i.rpos}return!1}},{key:"displayMarker",value:function(t,e,i,s,n,a,r,o,h){t.save(),null!=h&&(t.fillStyle=h,t.fillRect(e,i,s,n)),t.lineWidth=1,t.strokeStyle=o,t.setLineDash([1,1]),t.strokeRect(e,i,s,n),t.restore()}},{key:"pos2LinePos",value:function(t,e){var i=this.lines.pos2LineIndex(t);if(i>=0){var s=this.lines.array[i];if(t>=s.begin&&t<=s.end)return 0==e?s.begin:s.end}return 0}},{key:"pos2CaretRect",value:function(t,e){var i=this.lines.pos2LineIndex(t);if(i<0)return new d(0,0,0,0);var s=this.lines.array[i];t<s.begin&&(t=s.begin),t>s.end&&(t=s.end);var a=s.ci_array[t-s.begin].x,r=s.ci_array[t-s.begin].width;r<=0&&(r=n.CARET_WIDTH);var o=this.lines.getLineRect(i,!1);return o.l=a,o.r=e?a+r:o.l+n.CARET_WIDTH,o.t+=n.MARGIN_H,o.b+=n.MARGIN_H,o}},{key:"point2CaretRect",value:function(t,e){var i=-1,s=this.lines.point2LineIndex(t.y);(s+=e)<0&&(s=0),s>=this.lines.array.length&&(s=this.lines.array.length-1);for(var a=this.lines.array[s],r=null,o=a.begin;o<=a.end&&(i=o,r=a.ci_array[o-a.begin],!(t.x<=r.x+r.width/2));o++);var h=this.lines.getLineRect(s,!1);return h.l=r.x,h.r=r.x+n.CARET_WIDTH,h.t+=n.MARGIN_H,h.b+=n.MARGIN_H,{rect:h,pos:i}}},{key:"isAcceptableMailMerge",value:function(t,e){for(var i=t;i<=e;i++){if(this.getAttr(i).merge>=0)return!1}return!0}},{key:"getMailMergeRange",value:function(t){var e=this.getAttr(t);if(e.merge<0)return null;for(var i=t,s=t,n=t;n>=0&&!((e=this.getAttr(n)).merge<0);n--)i=n;for(var a=t;a<this.textstr.length-1&&!((e=this.getAttr(a)).merge<0);a++)s=a;return{lpos:i,rpos:s}}},{key:"findMailMergeRange",value:function(t){for(var e=[],i=0;i<this.textstr.length-1;){if(this.getAttr(i).merge==t){var s=this.getMailMergeRange(i);null!=s&&(e.push(s),i=s.rpos+1)}else i++}return e}},{key:"makeMailMergeDoc",value:function(e,i){if(e>=0&&e<this.textstr.length-1){var s=this.getAttrID(e),n=new t;n.textstr=[],n.offsets=[];for(var a=0;a<i.length;a++){var r=i.charAt(a);n.textstr.push(r),n.offsets.push(s)}return n.text_a.array[s]=this.text_a.array[s].clone(),n}return null}},{key:"dump",value:function(){for(var t="",e=0;e<this.textstr.length;e++)t+=this.textstr[e]+",";var i="";for(e=0;e<this.offsets.length;e++)i+=this.offsets[e]+",";for(var e in console.log("textstr:\n"+t),console.log("offsets:\n"+i),this.text_a.array){var s=this.text_a.array[e];console.log("text_a key:"+e+" value:"+s.facename+","+s.point+","+s.bold+","+s.italic)}for(var e in this.para_a.array)this.para_a.array[e];console.log("<-- end of dump.\n")}}]),t}();function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var L="",B=function(){function t(e,i,s,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.msg_target=e,this.doc_pos=new E(0,0),this.caret=new w,this.doc=new P(a),n.ORIENT_SIMPLE||this.doc.orient==n.ORIENT_HORZ?(this.edit_w=i,this.edit_h=s):(this.edit_w=s,this.edit_h=i),this.min_h=10,this.is_editable=!0,this.is_singleline=!1,this.is_autoresize=!0,this.is_clipping=!0,this.valign="top",this.bkcolor=null,this.is_composing=!1,this.composing_char="",this.overwrite_mode=!1,this.is_drag=!1,this.undo_stack=[],this.redo_stack=[],h.loadWebFonts(n.DEFAULT_FONT_FACENAME,(function(){console.log("load default font: "+n.DEFAULT_FONT_FACENAME)})),this.initTextarea()}var e,i,s;return e=t,(i=[{key:"initTextarea",value:function(){this.hiddenProp="position: absolute; z-index: -999; opacity: 0;font-size: 1px; width: 1px; height: 1px; ",this.hiddenTextarea=document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("wrap","off"),document.body.appendChild(this.hiddenTextarea),this.hiddenTextarea.style.cssText=this.hiddenProp+"left: 10px; top: 10px;",this.hiddenTextarea.focus(),this.hiddenTextarea.addEventListener("keydown",this.onKeyDown.bind(this),!1),this.hiddenTextarea.addEventListener("keypress",this.onKeyPress.bind(this),!1),this.hiddenTextarea.addEventListener("compositionstart",this.onCompositionStart.bind(this),!1),this.hiddenTextarea.addEventListener("compositionupdate",this.onCompositionUpdate.bind(this),!1),this.hiddenTextarea.addEventListener("compositionend",this.onCompositionEnd.bind(this),!1)}},{key:"moveTextarea",value:function(){var t=this.caret.rect.l,e=this.caret.rect.b+10,i="left:"+parseInt(t)+"px; top:"+parseInt(e)+"px;";this.hiddenTextarea.style.cssText=this.hiddenProp+i}},{key:"callbackUpdateState",value:function(){this.msg_target&&this.msg_target.updateStateCallback&&this.msg_target.updateStateCallback()}},{key:"callbackUpdateSize",value:function(t,e){this.msg_target&&this.msg_target.updateSizeCallback&&this.msg_target.updateSizeCallback(t,e)}},{key:"callbackMoveTextarea",value:function(){if(this.is_composing||(this.hiddenTextarea.value=""),this.doc.orient==n.ORIENT_HORZ)this.msg_target&&this.msg_target.moveTextareaCallback&&this.msg_target.moveTextareaCallback(this.caret.rect.r,this.caret.rect.b,this.hiddenTextarea);else{var t=this.rotatePoint(this.caret.rect.r,this.caret.rect.b,n.ORIENT_RADIAN);this.msg_target&&this.msg_target.moveTextareaCallback&&this.msg_target.moveTextareaCallback(t.x,t.y,this.hiddenTextarea)}}},{key:"loadDocument",value:function(t){this.edit_w=t.edit_w,this.edit_h=t.edit_h,this.bkcolor=t.bkcolor,this.valign=t.valign,this.is_editable=t.is_editable,this.is_singleline=t.is_singleline,this.is_autoresize=t.is_autoresize,this.is_clipping=t.is_clipping,n.WORDWRAP=t.is_wordwrap,n.HAN_WORD_CUT=t.is_han_wordcut,n.ENG_WORD_CUT=t.is_eng_wordcut;var e=this;return new Promise((function(i,s){e.undo_stack=[],e.redo_stack=[];var n=t.doc;if(n){var a=[];for(var r in n.text_a)a.push(n.text_a[r].facename);h.loadWebFonts(a,(function(){e.doc.loadData(n,!0),e.doc_pos.init(),e.moveCaretPos(e.doc_pos.getMove()),console.log("loadDocument complete."),e.doUpdateSizeCallback(),i()}))}else console.log("loadDocument failed."),s(new Error("invalid doc_data"))}))}},{key:"saveDocument",value:function(t){this.undo_stack=[],this.redo_stack=[],this.doc.deleteUnused();var e="{\n";return e+='"edit_w": '+this.edit_w+",\n",e+='"edit_h": '+this.edit_h+",\n",e+='"bkcolor": '+(n.isValidType(this.bkcolor)?'"'+this.bkcolor+'"':null)+",\n",e+='"valign": "'+this.valign+'",\n',e+='"is_editable": '+this.is_editable+",\n",e+='"is_singleline": '+this.is_singleline+",\n",e+='"is_autoresize": '+this.is_autoresize+",\n",e+='"is_clipping": '+this.is_clipping+",\n",e+='"is_wordwrap": '+n.WORDWRAP+",\n",e+='"is_han_wordcut": '+n.HAN_WORD_CUT+",\n",e+='"is_eng_wordcut": '+n.ENG_WORD_CUT+",\n",e+='"doc": '+this.doc.toJSON(!0),n.isValidType(t)&&1==t&&(e+=",\n",e+=this.doc.makeCoordinatesJSON(0,this.getDocY())),e+="}\n"}},{key:"isEmptyDoc",value:function(){return this.doc.getLength()<=0}},{key:"getDocY",value:function(){var t=0;switch(this.valign){case"top":t=0;break;case"middle":t=this.edit_h/2-this.getDocHeight()/2;break;case"bottom":t=this.edit_h-this.getDocHeight()}return t}},{key:"setSize",value:function(t,e,i){n.ORIENT_SIMPLE||this.doc.orient==n.ORIENT_HORZ?(this.edit_w=t,this.edit_h=e):(this.edit_w=e,this.edit_h=t),null==i&&(i=!0),this.adjustSize(i)}},{key:"setMinSize",value:function(t,e){n.ORIENT_SIMPLE||this.doc.orient==n.ORIENT_HORZ?this.min_h=e:this.min_h=t,this.adjustSize(!0)}},{key:"adjustSize",value:function(t){if(!this.is_singleline&&this.is_autoresize){var e=Math.floor(this.doc.getDocHeight()),i=Math.floor(this.edit_h);if(e>this.edit_h)i=e;else if(e<this.edit_h){var s=this.min_h;i=e<s?s:e}i>0&&i!=this.edit_h&&(this.edit_h=i,t&&this.doUpdateSizeCallback())}}},{key:"doUpdateSizeCallback",value:function(){n.ORIENT_SIMPLE||this.doc.orient==n.ORIENT_HORZ?this.callbackUpdateSize(this.edit_w,this.edit_h):this.callbackUpdateSize(this.edit_h,this.edit_w)}},{key:"orientDC",value:function(t){t.translate(this.edit_h/2,this.edit_h/2),t.rotate(n.ORIENT_RADIAN),t.translate(-this.edit_h/2,-this.edit_h/2)}},{key:"align",value:function(t,e){this.doc.alignDoc(t,this.edit_w,e),this.moveCaretPos(this.doc_pos.getMove()),this.adjustSize(!0)}},{key:"draw",value:function(t){if(t){t.save(),n.ORIENT_SIMPLE||this.doc.orient!=n.ORIENT_HORZ&&this.orientDC(t),this.align(t,!0),this.is_clipping&&(t.beginPath(),t.rect(0,0,this.edit_w,this.edit_h),t.clip()),n.isValidType(this.bkcolor)&&(t.fillStyle=this.bkcolor,t.fillRect(0,0,this.edit_w,this.edit_h)),this.isOverflowText()&&(t.fillStyle=n.COLOR_TBOX_WARNING_FILL,t.fillRect(0,0,this.edit_w,this.edit_h));var e=this.getDocY(),i=this.doc_pos.getBlock();if(this.is_editable){var s=this.isFocus()?n.BLOCK_DISPLAY_FOCUS:n.BLOCK_DISPLAY_KILLFOCUS;this.doc.display(t,0,e,this.edit_h,i,s,this.is_clipping),this.caret.display(t,0,e,this.is_composing)}else this.doc.display(t,0,e,this.edit_h,i,n.BLOCK_DISPLAY_NONE,this.is_clipping);t.restore()}}},{key:"rotatePoint",value:function(t,e,i){var s=this.edit_h/2,n=this.edit_h/2,a={x:t,y:e};return i&&(a.x=(t-s)*Math.cos(i)-(e-n)*Math.sin(i)+s,a.y=(t-s)*Math.sin(i)+(e-n)*Math.cos(i)+n),a}},{key:"mouseDown",value:function(t,e,i,s){if(this.setFocus(),!n.ORIENT_SIMPLE&&this.doc.orient!=n.ORIENT_HORZ){var a=this.rotatePoint(e,i,-n.ORIENT_RADIAN);e=a.x,i=a.y}i-=this.getDocY();var r=new f(e,i),o=this.moveCaretPoint(t,r,!0);o>=0&&(s?this.doc_pos.setMove(o):this.doc_pos.setPos(o),this.is_drag=!0)}},{key:"mouseMove",value:function(t,e,i){if(this.is_drag){if(!n.ORIENT_SIMPLE&&this.doc.orient!=n.ORIENT_HORZ){var s=this.rotatePoint(e,i,-n.ORIENT_RADIAN);e=s.x,i=s.y}i-=this.getDocY();var a=new f(e,i),r=this.moveCaretPoint(t,a,!0);r>=0&&this.doc_pos.setMove(r)}}},{key:"mouseUp",value:function(t,e){this.is_drag=!1,this.callbackUpdateState()}},{key:"onKeyDown",value:function(t){if(!this.isFocus())return!1;var e=t.which||t.keyCode;switch(e){case 113:n.BOUNDBOX=!n.BOUNDBOX;break;case 114:this.dumpUndoRedo();break;case 115:this.replaceMailMerge(0,"wow,");break;case 220:break;case 32:t.preventDefault(),this.insertChars(n.SPACEKEY,1,n.RECORD_INS);break;case 9:t.preventDefault(),this.insertChars(n.TABKEY,1,n.RECORD_INS);break;case 10:case 13:this.is_singleline||(t.preventDefault(),this.insertChars(n.ENTERKEY,1,n.RECORD_INS));break;case 90:t.ctrlKey&&(t.preventDefault(),t.shiftKey?this.redo():this.undo());break;case 89:t.ctrlKey&&(t.preventDefault(),this.redo());break;case 67:case 88:case 86:t.ctrlKey&&(t.preventDefault(),67==e?this.copy():88==e?(this.copy(),this.deleteChars(0,n.RECORD_DEL)):86==e&&this.paste());break;case 8:t.preventDefault(),this.deleteChars(-1,n.RECORD_DEL);break;case 46:t.preventDefault(),this.deleteChars(1,n.RECORD_DEL);break;case 45:t.preventDefault(),this.overwrite_mode=!this.overwrite_mode;break;case 65:t.ctrlKey&&(t.preventDefault(),this.select(0,this.doc.getLength()),this.callbackUpdateState());break;case 33:case 36:t.preventDefault(),this.moveHome(this.doc_pos.getMove(),t.shiftKey),this.callbackUpdateState();break;case 34:case 35:t.preventDefault(),this.moveEnd(this.doc_pos.getMove(),t.shiftKey),this.callbackUpdateState();break;case 37:t.preventDefault(),this.doc.orient==n.ORIENT_HORZ?this.leftKey(t.shiftKey):this.downKey(t.shiftKey),this.moveCaretPos(this.doc_pos.getMove()),this.callbackUpdateState();break;case 39:t.preventDefault(),this.doc.orient==n.ORIENT_HORZ?this.rightKey(t.shiftKey):this.upKey(t.shiftKey),this.moveCaretPos(this.doc_pos.getMove()),this.callbackUpdateState();break;case 38:t.preventDefault(),this.doc.orient==n.ORIENT_HORZ?this.upKey(t.shiftKey):this.leftKey(t.shiftKey),this.callbackUpdateState();break;case 40:t.preventDefault(),this.doc.orient==n.ORIENT_HORZ?this.downKey(t.shiftKey):this.rightKey(t.shiftKey),this.callbackUpdateState()}return this.callbackMoveTextarea(),!0}},{key:"leftKey",value:function(t){t?this.doc_pos.moveBlockLeft(0):this.doc_pos.moveLeft(0)}},{key:"rightKey",value:function(t){t?this.doc_pos.moveBlockRight(this.doc.getLength()):this.doc_pos.moveRight(this.doc.getLength())}},{key:"upKey",value:function(t){var e=new f(this.caret.getBaseX(),this.caret.rect.t+this.caret.rect.height()/3),i=this.moveLineCaretPoint(e,!1,-1);t?this.doc_pos.setMove(i):this.doc_pos.setPos(i)}},{key:"downKey",value:function(t){var e=new f(this.caret.getBaseX(),this.caret.rect.t+this.caret.rect.height()/3),i=this.moveLineCaretPoint(e,!1,1);t?this.doc_pos.setMove(i):this.doc_pos.setPos(i)}},{key:"onKeyPress",value:function(t){if(!this.isFocus())return!1;if(!this.is_composing){var e=t.which||t.keyCode,i=String.fromCharCode(e);return this.insertChars(i,1,n.RECORD_INS),this.composing_char="",this.callbackMoveTextarea(),!0}}},{key:"onCompositionStart",value:function(t){return t.data||t.keyCode,this.is_composing=!0,this.composing_char="",this.callbackMoveTextarea(),!0}},{key:"onCompositionUpdate",value:function(t){var e=t.data||t.keyCode;return n.isValidType(e)?this.insertChars(e,1,n.RECORD_INS):(console.log("invalid:"+e),this.composing_char.length>0&&this.deleteChars(-1,n.RECORD_OFF),e=""),this.is_composing=!0,this.composing_char=e,!0}},{key:"onCompositionEnd",value:function(t){var e=t.data||t.keyCode;return n.isValidType(e)?(this.insertChars(e,1,n.RECORD_INS),e.length>1&&(console.log("mac case:"+e),this.insertChars(e[1],1,n.RECORD_INS))):console.log("조합끝(invalid):"+e),this.is_composing=!1,this.composing_char="",this.callbackMoveTextarea(),!0}},{key:"isOverflowText",value:function(){if(this.is_singleline&&this.doc.getLength()>0){var t=this.doc.getAlignedWidth();if(t>0&&t>this.edit_w)return!0;if(this.getDocHeight()>this.edit_h)return!0}return!1}},{key:"insertDoc",value:function(t,e){if(this.is_editable){this.doc_pos.isBlock()&&this.deleteChars(0,n.RECORD_DEL);var i=this.doc_pos.getMove(),s=i+t.textstr.length;if(this.doc.insertDoc(i,t),this.doc_pos.setPos(s),e!=n.RECORD_OFF){var a=new E(i,i),r=t;this.recordOp(e,a,null,r)}}}},{key:"insertChars",value:function(t,e,i){if(this.is_editable){this.doc_pos.isBlock()&&this.deleteChars(0,n.RECORD_DEL);var s=this.overwrite_mode;this.is_composing&&(this.composing_char.length<=0||(s=!0,this.doc_pos.moveLeft(0)));var a=this.doc_pos.getMove(),r=a+e,o=this.doc.insertChars(a,t,e,s);if(this.doc_pos.setPos(r),i!=n.RECORD_OFF){var h=new E(a,a);if(o.replaced)if(this.is_composing)if(this.overwrite_mode){var l=this.undo_stack.pop();l.type==n.RECORD_REPL&&l.pos.isEqual(h)?this.recordOp(n.RECORD_REPL,h,l.del,t):(this.undo_stack.push(l),this.recordOp(n.RECORD_REPL,h,o.replaced,t))}else{this.undo_stack.pop();var c=this.doc.getBlockDoc(a,r-1);this.recordOp(n.RECORD_INS,h,null,c)}else this.recordOp(n.RECORD_REPL,h,o.replaced,t);else c=this.doc.getBlockDoc(a,r-1),this.recordOp(i,h,null,c)}}}},{key:"deleteChars",value:function(t,e){if(this.is_editable)if(this.doc_pos.isBlock()){var i=this.doc_pos.getBlock();if(i.left>=0&&i.right>=0){if(e!=n.RECORD_OFF){var s=new E(i.left,i.left);null!=(a=this.doc.getBlockDoc(i.left,i.right))&&this.recordOp(e,s,a,null)}this.doc_pos.setPos(i.left),this.doc.deleteChars(i.left,i.right-i.left+1)}}else{if(t<0){if(!this.doc_pos.moveLeft(0))return;t=1}var a,r=this.doc_pos.getMove();if(e!=n.RECORD_OFF)s=new E(r,r),null!=(a=this.doc.getBlockDoc(r,r+t-1))&&this.recordOp(e,s,a,null);this.doc.deleteChars(r,t),this.doc_pos.setPos(r)}}},{key:"select",value:function(t,e){if(!(t<0||t>=e)){this.doc_pos.setPos(t),this.doc_pos.setMove(e);var i=this.doc.pos2CaretRect(e,this.overwrite_mode);this.caret.setRect(i),this.caret.setBaseX(i.l)}}},{key:"moveHome",value:function(t,e){var i=this.doc.pos2LinePos(t,0);e?this.doc_pos.setMove(i):this.doc_pos.setPos(i);var s=this.doc.pos2CaretRect(i,this.overwrite_mode);this.caret.setRect(s),this.caret.setBaseX(s.l)}},{key:"moveEnd",value:function(t,e){var i=this.doc.pos2LinePos(t,1);e?this.doc_pos.setMove(i):this.doc_pos.setPos(i);var s=this.doc.pos2CaretRect(i,this.overwrite_mode);this.caret.setRect(s),this.caret.setBaseX(s.l)}},{key:"moveCaretPos",value:function(t){this.is_composing&&--t,t<0&&(t=0),t>this.doc.getLength()&&(t=this.doc.getLength());var e=this.doc.pos2CaretRect(t,this.is_composing||this.overwrite_mode);this.caret.setRect(e),this.caret.setBaseX(e.l)}},{key:"moveCaretPoint",value:function(t,e,i){this.align(t,!0);var s=this.doc.point2CaretRect(e,0);return this.caret.setRect(s.rect),i&&this.caret.setBaseX(s.rect.l),s.pos}},{key:"moveLineCaretPoint",value:function(t,e,i){var s=this.doc.point2CaretRect(t,i);return this.caret.setRect(s.rect),e&&this.caret.setBaseX(s.rect.l),s.pos}},{key:"copyDoc",value:function(){if(!this.doc_pos.isBlock())return"";var t=this.doc_pos.getBlock(),e=this.doc.getBlockDoc(t.left,t.right);return null!=e?e.toJSON():""}},{key:"pasteDoc",value:function(t){if(!(t.length<=0))try{var e=JSON.parse(t);if("object"===I(e)){var i=new P;i.loadData(e),this.insertDoc(i,n.RECORD_INS)}else this.pasteText(t)}catch(e){this.pasteText(t)}}},{key:"setFontProp",value:function(t,e){if(this.is_editable)if(this.doc_pos.isBlock()){var i=this.doc_pos.getBlock(),s=this.doc.getBlockDoc(i.left,i.right);this.doc.setBlockAttrState(i.left,i.right,t,e);var a=new E(i.left,i.right),r=this.doc.getBlockDoc(i.left,i.right);this.recordOp(n.RECORD_ATTR,a,s,r)}else a=this.doc_pos.getMove(),this.doc.setAttrState(a,t,e)}},{key:"setParaProp",value:function(t,e){if(this.is_editable)if(this.doc_pos.isBlock()){var i=this.doc_pos.getBlock(),s=this.doc.getSelParas(i.left,i.right);this.doc.setBlockParaState(i.left,i.right,t,e);var a=new E(i.left,i.right),r=this.doc.getSelParas(i.left,i.right);this.recordOp(n.RECORD_PARA,a,s,r)}else{var o=this.doc_pos.getMove();s=this.doc.getSelParas(o,-1),this.doc.setParaState(o,t,e),a=new E(o,-1),r=this.doc.getSelParas(o,-1),this.recordOp(n.RECORD_PARA,a,s,r)}}},{key:"recordOp",value:function(t,e,i,s){this.redo_stack=[];var a=null;switch(t){case n.RECORD_INS:a=new O(t,e,null,s);break;case n.RECORD_REPL:a=new O(t,e,i,s);break;case n.RECORD_DEL:a=new O(t,e,i,null);break;case n.RECORD_ATTR:case n.RECORD_PARA:a=new O(t,e,i,s);break;case n.RECORD_VALIGN:a=new O(t,e,i,s)}null!=a&&this.undo_stack.push(a)}},{key:"undoAction",value:function(t){if(!t)return!1;switch(t.type){case n.RECORD_INS:this.doc_pos.setPos(t.pos.getPivot()),this.deleteChars(t.ins.textstr.length,n.RECORD_OFF);break;case n.RECORD_REPL:this.doc_pos.setPos(t.pos.getPivot()),this.doc.insertChars(t.pos.getPivot(),t.del,1,!0);break;case n.RECORD_DEL:this.doc_pos.setPos(t.pos.getPivot()),this.insertDoc(t.del,n.RECORD_OFF);break;case n.RECORD_ATTR:this.doc_pos.setPos(t.pos.getPivot()),this.deleteChars(t.ins.textstr.length,n.RECORD_OFF),this.insertDoc(t.del,n.RECORD_OFF);break;case n.RECORD_PARA:this.doc_pos.setPos(t.pos.getPivot()),this.doc.setSelParas(t.pos.getPivot(),t.pos.getMove(),t.del);break;case n.RECORD_VALIGN:this.valign=t.del}return!0}},{key:"redoAction",value:function(t){if(!t)return!1;switch(t.type){case n.RECORD_INS:this.doc_pos.setPos(t.pos.getPivot()),this.insertDoc(t.ins,n.RECORD_OFF);break;case n.RECORD_REPL:this.doc_pos.setPos(t.pos.getPivot()),this.doc.insertChars(t.pos.getPivot(),t.ins,1,!0);break;case n.RECORD_DEL:this.doc_pos.setPos(t.pos.getPivot()),this.deleteChars(t.del.textstr.length,n.RECORD_OFF);break;case n.RECORD_ATTR:this.doc_pos.setPos(t.pos.getPivot()),this.deleteChars(t.del.textstr.length,n.RECORD_OFF),this.insertDoc(t.ins,n.RECORD_OFF);break;case n.RECORD_PARA:this.doc_pos.setPos(t.pos.getPivot()),this.doc.setSelParas(t.pos.getPivot(),t.pos.getMove(),t.ins);break;case n.RECORD_VALIGN:this.valign=t.ins}return!0}},{key:"dumpUndoRedo",value:function(){console.log(">> tbox stack log");for(var t=null,e=0;e<2;e++){0==e?(console.log("undo_stack.........................................................."),t=this.undo_stack):(console.log("redo_stack.........................................................."),t=this.redo_stack);for(var i=0;i<t.length;i++){var s="";switch(t[i].type){case n.RECORD_INS:s="insert  ";break;case n.RECORD_REPL:s="replace ";break;case n.RECORD_DEL:s="delete  ";break;case n.RECORD_ATTR:s="attr    ";break;case n.RECORD_PARA:s="para    "}if(s+="["+t[i].pos.getPivot()+","+t[i].pos.getMove()+"]",t[i].ins){var a=t[i].ins.textstr;n.isValidType(a)||(a=t[i].ins),s+=" (ins)",s+=a}t[i].del&&(a=t[i].del.textstr,n.isValidType(a)||(a=t[i].del),s+=" (del)",s+=a),console.log(s)}}}},{key:"getOrient",value:function(){return this.doc.orient}},{key:"setOrient",value:function(t){this.doc.setOrient(t),this.setFocus()}},{key:"getColor",value:function(){return this.bkcolor}},{key:"setColor",value:function(t){this.bkcolor=t,this.setFocus()}},{key:"getOption",value:function(){return{is_editable:this.is_editable,is_singleline:this.is_singleline,is_autoresize:this.is_autoresize,is_clipping:this.is_clipping,is_wordwrap:n.WORDWRAP,is_han_wordcut:n.HAN_WORD_CUT,is_eng_wordcut:n.ENG_WORD_CUT}}},{key:"setOption",value:function(t){void 0!==t.is_editable&&(this.is_editable=t.is_editable),void 0!==t.is_singleline&&(this.is_singleline=t.is_singleline),void 0!==t.is_autoresize&&(this.is_autoresize=t.is_autoresize),void 0!==t.is_clipping&&(this.is_clipping=t.is_clipping),void 0!==t.is_wordwrap&&(n.WORDWRAP=t.is_wordwrap),void 0!==t.is_han_wordcut&&(n.HAN_WORD_CUT=t.is_han_wordcut),void 0!==t.is_eng_wordcut&&(n.ENG_WORD_CUT=t.is_eng_wordcut)}},{key:"setFontDefault",value:function(t){var e=new _;if(n.isValidType(t.facename)&&t.facename.length>0&&(e.facename=t.facename),n.isValidType(t.point)&&t.point>0&&(e.point=t.point),n.isValidType(t.textcolor)&&t.textcolor.length>0&&(e.textcolor=t.textcolor),n.isValidType(t.backcolor)&&t.backcolor.length>0&&(e.backcolor=t.backcolor),n.isValidType(t.bold)&&(e.bold=t.bold),n.isValidType(t.italic)&&(e.italic=t.italic),n.isValidType(t.charw)&&t.charw>0&&(e.charw=t.charw),n.isValidType(t.charg)&&t.charg>0&&(e.charg=t.charg),n.isValidType(t.underline)&&(e.underline=new p,e.underline.loadData(t.underline)),n.isValidType(t.strikeout)&&(e.strikeout=new p,e.strikeout.loadData(t.strikeout)),n.isValidType(t.strokeline)&&(e.strokeline=new p,e.strokeline.loadData(t.strokeline)),n.isValidType(t.shadow)&&(e.shadow=new g,e.shadow.loadData(t.shadow)),n.isValidType(t.facename)&&t.facename.length>0){var i=this;h.loadWebFonts(t.facename,(function(){console.log("setFontDefault: "+t.facename),i.doc.setDefault(e,null)}))}else this.doc.setDefault(e,null)}},{key:"setParaDefault",value:function(t){var e=new m;n.isValidType(t.align)&&t.align.length>0&&(e.align=t.align),n.isValidType(t.linegap_unit)&&t.linegap_unit.length>0&&(e.linegap_unit=t.linegap_unit),n.isValidType(t.linegap_value)&&(e.linegap_value=t.linegap_value),n.isValidType(t.paragap)&&(e.paragap=new d(0,0,0,0),e.paragap.loadData(t.paragap)),n.isValidType(t.indent)&&(e.indent=t.indent),n.isValidType(t.tabsize)&&(e.tabsize=t.tabsize),this.doc.setDefault(null,e)}},{key:"getFontState",value:function(){var t=null;if(this.doc_pos.isBlock()){var e=this.doc_pos.getBlock();t=this.doc.getBlockAttrState(e.left,e.right)}else e=this.doc_pos.getMove(),t=this.doc.getAttrState(e);return null==t.attr||null==t.filter?null:t}},{key:"setFontState",value:function(t,e){var i=new _,s=new v(!1);if(n.isUndefined(t.facename)||(s.facename=!0,i.facename=t.facename),n.isUndefined(t.point)||(s.point=!0,i.point=t.point),n.isUndefined(t.textcolor)||(s.textcolor=!0,i.textcolor=t.textcolor),n.isUndefined(t.backcolor)||(s.backcolor=!0,i.backcolor=t.backcolor),n.isUndefined(t.bold)||(s.bold=!0,i.bold=t.bold),n.isUndefined(t.italic)||(s.italic=!0,i.italic=t.italic),n.isUndefined(t.charw)||(s.charw=!0,i.charw=t.charw),n.isUndefined(t.charg)||(s.charg=!0,i.charg=t.charg),n.isUndefined(t.wordg)||(s.wordg=!0,i.wordg=t.wordg),n.isUndefined(t.underline)||(s.underline=!0,null==t.underline?i.underline=t.underline:(i.underline=new p,i.underline.loadData(t.underline))),n.isUndefined(t.strikeout)||(s.strikeout=!0,null==t.strikeout?i.strikeout=t.strikeout:(i.strikeout=new p,i.strikeout.loadData(t.strikeout))),n.isUndefined(t.strokeline)||(s.strokeline=!0,null==t.strokeline?i.strokeline=t.strokeline:(i.strokeline=new p,i.strokeline.loadData(t.strokeline))),n.isUndefined(t.shadow)||(s.shadow=!0,null==t.shadow?i.shadow=t.shadow:(i.shadow=new g,i.shadow.loadData(t.shadow))),n.isUndefined(t.merge)||(s.merge=!0,i.merge=t.merge),n.isUndefined(t.nocut)||(s.nocut=!0,i.nocut=t.nocut),s.facename&&i.facename.length>0){var a=this;h.loadWebFonts(i.facename,(function(){a.setFontProp(i,s),n.isValidType(e)&&e()}))}else this.setFontProp(i,s);this.setFocus()}},{key:"getParaState",value:function(){var t=null;if(this.doc_pos.isBlock()){var e=this.doc_pos.getBlock();t=this.doc.getBlockParaState(e.left,e.right)}else e=this.doc_pos.getMove(),t=this.doc.getParaState(e);return null==t.para||null==t.filter?null:t}},{key:"setParaState",value:function(t){var e=new m,i=new k(!1);n.isUndefined(t.align)||(i.align=!0,e.align=t.align),n.isUndefined(t.linegap_unit)||(i.linegap_unit=!0,e.linegap_unit=t.linegap_unit),n.isUndefined(t.linegap_value)||(i.linegap_value=!0,e.linegap_value=t.linegap_value),n.isUndefined(t.paragap)||(i.paragap=!0,e.paragap=t.paragap),n.isUndefined(t.indent)||(i.indent=!0,e.indent=t.indent),n.isUndefined(t.tabsize)||(i.tabsize=!0,e.tabsize=t.tabsize),this.setParaProp(e,i),this.setFocus()}},{key:"setVAlign",value:function(t,e){var i=this.valign,s=t;this.valign=t,e&&this.recordOp(n.RECORD_VALIGN,0,i,s),this.setFocus()}},{key:"getVAlign",value:function(){return this.valign}},{key:"getWidth",value:function(){return n.ORIENT_SIMPLE||this.doc.orient==n.ORIENT_HORZ?this.edit_w:this.edit_h}},{key:"getHeight",value:function(){return n.ORIENT_SIMPLE||this.doc.orient==n.ORIENT_HORZ?this.edit_h:this.edit_w}},{key:"getDocWidth",value:function(){return this.doc.getDocWidth()}},{key:"getDocHeight",value:function(){return this.doc.getDocHeight()}},{key:"isFocus",value:function(){return this.caret.isShow()}},{key:"setFocus",value:function(){this.hiddenTextarea.focus(),this.caret.show(!0)}},{key:"killFocus",value:function(){this.hiddenTextarea.blur(),this.caret.show(!1)}},{key:"selectAll",value:function(){this.select(0,this.doc.getLength()),this.callbackUpdateState()}},{key:"fromString",value:function(t){this.undo_stack=[],this.redo_stack=[],t=(t=(t=t.replace(/\r\n/gi,n.ENTERKEY)).replace(/\n/gi,n.ENTERKEY)).replace(/\r/gi,n.ENTERKEY),this.select(0,this.doc.getLength()),this.insertChars(t,t.length,n.RECORD_OFF)}},{key:"toString",value:function(){return this.doc.toString()}},{key:"copyText",value:function(){if(!this.doc_pos.isBlock())return"";var t=this.doc_pos.getBlock();return this.doc.getBlockText(t.left,t.right)}},{key:"pasteText",value:function(t){this.insertChars(t,t.length,n.RECORD_INS)}},{key:"copy",value:function(){if(L=this.copyDoc(),navigator.clipboard){var t=this.copyText();t.length>0&&navigator.clipboard.writeText(t).then((function(){console.log("string was copied to clipboard..")}),(function(){console.error("failed to copy..")}))}else console.error("navigator.clipboard is not supported..")}},{key:"paste",value:function(){if(this.is_editable)if(L.length>0)this.pasteDoc(L);else if(navigator.clipboard){var t=this;navigator.permissions.query({name:"clipboard-read"}).then((function(e){"granted"!=e.state&&"prompt"!=e.state||navigator.clipboard.readText().then((function(e){t.pasteText(e)}),(function(t){console.error("failed to paste..")}))}))}else console.error("navigator.clipboard is not supported..")}},{key:"isAcceptableMailMerge",value:function(){var t=this.doc_pos.getLeft(),e=this.doc_pos.getRight();return this.doc.isAcceptableMailMerge(t,e)}},{key:"insertMailMerge",value:function(t,e){if((t=parseInt(t))<0)return!1;if(e.length<=0)return!1;if(!this.isAcceptableMailMerge())return!1;this.insertChars(e,e.length,n.RECORD_INS);var i=this.doc_pos.getMove()-e.length;return this.select(i,i+e.length),this.setFontState({merge:t}),this.setFocus(),!0}},{key:"replaceMailMerge",value:function(t,e){if((t=parseInt(t))<0)return!1;if(e.length<=0)return!1;var i=this.doc.findMailMergeRange(t);if(i.length<=0)return!1;for(var s=i.length-1;s>=0;s--){var a=i[s],r=this.doc.makeMailMergeDoc(a.lpos,e);null!=r&&(this.select(a.lpos,a.rpos+1),this.insertDoc(r,n.RECORD_INS))}return this.setFocus(),!0}},{key:"undo",value:function(){if(!this.is_editable)return!1;if(this.is_composing)return!1;if(this.undo_stack.length>0){var t=this.undo_stack.pop();null!=t&&(this.undoAction(t),this.redo_stack.push(t))}return!0}},{key:"redo",value:function(){if(!this.is_editable)return!1;if(this.is_composing)return!1;if(this.redo_stack.length>0){var t=this.redo_stack.pop();null!=t&&(this.redoAction(t),this.undo_stack.push(t))}return!0}},{key:"setBoundBox",value:function(t){n.BOUNDBOX=t}}])&&S(e.prototype,i),s&&S(e,s),t}()}])}));